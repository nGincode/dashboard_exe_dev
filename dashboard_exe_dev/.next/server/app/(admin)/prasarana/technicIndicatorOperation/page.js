(()=>{var e={};e.id=5208,e.ids=[5208],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},60717:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>o.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>m,tree:()=>d}),t(97225),t(20461),t(24513),t(57198),t(12742),t(39614),t(26083),t(19644),t(96560);var r=t(23191),n=t(88716),i=t(37922),o=t.n(i),l=t(95231),s={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(s[e]=()=>l[e]);t.d(a,s);let d=["",{children:["(admin)",{children:["prasarana",{children:["technicIndicatorOperation",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,97225)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\prasarana\\technicIndicatorOperation\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,20461)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,24513)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\error.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,57198)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,12742)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\not-found.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,39614)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,26083)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\error.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,19644)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\not-found.tsx"]}],c=["D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\prasarana\\technicIndicatorOperation\\page.tsx"],p="/(admin)/prasarana/technicIndicatorOperation/page",u={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/(admin)/prasarana/technicIndicatorOperation/page",pathname:"/prasarana/technicIndicatorOperation",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},44340:(e,a,t)=>{Promise.resolve().then(t.bind(t,38707))},38707:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>Y});var r=t(10326),n=t(17577),i=t(20341),o=t(95425),l=t(44624),s=t(74525),d=t(34626),c=t(92379),p=t(4799),u=t(6400),m=t(21063),h=t(55113),g=t(60816),_=t(50784),f=t(91862),y=t(35285),x=t(3204),k=t(87337),b=t(75698),j=t(37619),v=t(75958),P=t(57911),S=t(97458),w=t(52279),A=t(35047),E=t(88295),C=t.n(E),N=t(68080),Z=t(40557),I=t(63191),T=t(44099);let F=({visible:e,onCancel:a,dataPerFile:t,getDataMaster:i,periodeDate:o})=>{let{date:s,recordForDay:c,dateKey:u}=t,[h,_]=(0,n.useState)({}),f=d.Z.useApp(),{message:y,notification:x,modal:k}=f,b=async(e,t,r)=>{let n=t.i_id;_(e=>({...e,[r]:{loading:!0,error:!1}}));let d=new FormData;d.append("i_id",n),d.append("d_opr",s),d.append("n_file_path",e);try{let e=await (0,w.Z)({"Content-Type":"multipart/form-data"}).post("/prasarana/operation/technical/file",d);(0,l.Z)({res:e,app:f})?(y.success("Successful Save"),_(e=>({...e,[r]:{loading:!1,error:!1}})),i(o.period_year,o.period_month),a()):_(e=>({...e,[r]:{loading:!1,error:!0}}))}catch(e){console.error("Error uploading file:",e),_(e=>({...e,[r]:{loading:!1,error:!0}}))}},j=async e=>{try{let t={i_id:e.i_id};_(e=>({...e,[u]:{loading:!0,error:!1}}));let r=await (0,w.Z)().del("/prasarana/operation/technical/file",t);200===r.status?(_(e=>({...e,[u]:{loading:!1,error:!1}})),y.success("Successful Save"),i(o.period_year,o.period_month),a()):_(e=>({...e,[u]:{loading:!1,error:!0}}))}catch(e){console.error("Error deleting file:",e),_(e=>({...e,[u]:{loading:!1,error:!0}}))}},P=async e=>{if(!e){y.error("File tidak tersedia.");return}try{_(e=>({...e,[u]:{loading:!0,error:!1}}));let a=localStorage.getItem("accessToken"),t=await T.Z.get(e,{responseType:"blob",headers:{Authorization:`Bearer ${a}`}});if("application/json"===t.data.type){let e=new FileReader;e.onload=()=>{let a=JSON.parse(e.result);if("401"===a.code){y.error("Download failed"),_(e=>({...e,[u]:{loading:!1,error:!0}}));return}},e.readAsText(t.data);return}let r=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=r,n.setAttribute("download","file.pdf"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r),y.success("File berhasil diunduh"),_(e=>({...e,[u]:{loading:!1,error:!1}}))}catch(e){console.error("Error downloading file:",e),y.error("Gagal mengunduh file"),_(e=>({...e,[u]:{loading:!1,error:!0}}))}finally{_(e=>({...e,[u]:{loading:!1,error:!1}}))}},{loading:S,error:A}=h[u]||{loading:!1,error:!1};return(0,r.jsxs)(v.Z,{title:"File Options",visible:e,footer:null,onCancel:a,children:[r.jsx("p",{children:"Anda dapat melakukan download, upload, atau menghapus file ini."}),(0,r.jsxs)("div",{className:"mt-4 flex justify-between items-center px-8",children:[r.jsx(g.ZP,{icon:r.jsx(N.Z,{}),type:"link",size:"large",style:{width:"120px"},disabled:S,onClick:()=>P(t?.recordForDay?.n_file_path),children:"Download"}),r.jsx(p.default,{beforeUpload:e=>("application/pdf"!==e.type?y.error("You can only upload PDF files!"):b(e,c,u),!1),showUploadList:!1,maxCount:1,accept:"application/pdf",children:r.jsx(g.ZP,{icon:r.jsx(Z.Z,{}),type:"link",size:"large",disabled:S,style:{width:"120px"},children:r.jsx("span",{children:"Upload"})})}),r.jsx(g.ZP,{danger:!0,disabled:S,icon:r.jsx(I.Z,{}),size:"large",type:"link",style:{width:"120px"},onClick:()=>j(c),children:"Delete"})]}),S&&r.jsx(m.Z,{spinning:S,children:"Processing..."}),A&&r.jsx("p",{style:{color:"red"},children:"Error: Failed file."})]})};var M=t(59270),$=t(46752);let D=["Tindakan Pemeriksaan","- Pemeriksaan jalur","- Pemeriksaan Bangunan","- Pemeriksaan Fasopka","Tindakan Pengoperasian","- Frekuensi Perjalanan KA Weekday","- Frekuensi Perjalanan KA Weekend"],R=e=>D?.flatMap((a,t)=>{let r=null,n="";return e?.forEach(e=>{let i=e.record?.find(e=>`- ${e.n_indicator_item}`===a);i&&(r={key:`${t}`,n_indicator_item:a,i_target:i.i_target,i_realization:i.i_realization,n_indicator:e.n_indicator},n=e.n_indicator)}),r||{key:`${t}`,n_indicator_item:a,i_target:null,i_realization:null,n_indicator:n||""}}),U=({eachListTableData:e,status:a,periodeDate:t,getDataMaster:i})=>{let o=d.Z.useApp(),s=R(e),[p,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)([]),[_,f]=(0,n.useState)(!1),[y,x]=(0,n.useState)(!1),k=e=>"Tindakan Pemeriksaan"===e||"Tindakan Pengoperasian"===e,b=async()=>{try{if(0===m.length){console.log("Tidak ada perubahan yang disimpan");return}f(!0);let e={period_year:t.period_year.split("_")[0],period_month:t.period_month.split("_")[0],data:m},a=await (0,w.Z)().post("/prasarana/operation/technical/summary",e);(0,l.Z)({res:a,app:o})?(f(!1),i(t.period_year,t.period_month),$.ZP.success("Successful Save")):f(!1)}catch(e){console.log("error",e)}finally{f(!1)}},v=(e,a,t)=>{let r=[...m],n=a.n_indicator_item.replace("- ",""),i=n.includes("Pemeriksaan"),o=n.includes("Frekuensi Perjalanan"),l=i?"Pemeriksaan":o?"Pengoperasian":a.n_indicator_item,s=null!==e?Number(e):0,d=r.findIndex(e=>e.n_indicator===l);if(-1===d)r.push({n_indicator:l,record:[{n_indicator_item:n,i_target:"i_target"===t?s:a.i_target,i_realization:"i_realization"===t?s:a.i_realization}]});else{let e=r[d].record.findIndex(e=>e.n_indicator_item===n);-1===e?r[d].record.push({n_indicator_item:n,i_target:"i_target"===t?s:a.i_target,i_realization:"i_realization"===t?s:a.i_realization}):r[d].record[e][t]=s}h(r)},P=async()=>{try{x(!0);let a=e.flatMap(e=>e.record.map(e=>({i_id:e.i_id}))),r=await (0,w.Z)().put("/prasarana/approval",{c_dashboard_type:"PENGOPERASIAN",c_param:"TEKNIS_SUMMARY",data:a});(0,l.Z)({res:r,app:o})?(x(!1),i(t.period_year,t.period_month),$.ZP.success("Successfully Approved")):x(!1)}catch(e){console.log("error",e)}finally{x(!1)}},S=async()=>{try{x(!0);let a=e.flatMap(e=>e.record.map(e=>({i_id:e.i_id}))),r=await (0,w.Z)().put("/prasarana/unapproval",{c_dashboard_type:"PENGOPERASIAN",c_param:"TEKNIS_SUMMARY",data:a});(0,l.Z)({res:r,app:o})?(x(!1),i(t.period_year,t.period_month),$.ZP.success("Successfully Approved")):x(!1)}catch(e){console.log("error",e)}finally{x(!1)}},A=e=>{switch(e){case 1:return r.jsx(c.Z,{color:"blue",children:r.jsx("span",{className:"font-semibold",children:"Ready to Approve"})});case 2:return r.jsx(c.Z,{color:"red",children:r.jsx("span",{className:"font-semibold",children:"Unapprove"})});case 4:return r.jsx(c.Z,{color:"green",children:r.jsx("span",{className:"font-semibold",children:"Approved"})});default:return"null"}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"text-end",children:[null!==a&&r.jsx(g.ZP,{type:1===a?"primary":"default",className:"mb-5 mr-4",onClick:1===a?P:S,loading:y,children:1===a?"Approve":"Unapprove"}),r.jsx(g.ZP,{type:"primary",className:"mb-5",onClick:()=>{u(!p),p&&b()},loading:_,children:p?"Save":"Edit"})]}),r.jsx(j.Z,{columns:[{title:"Kepatuhan Pelaksanaan Pemeriksaan dan Pengoperasian",dataIndex:"n_indicator_item",key:"n_indicator_item",fixed:"left",width:300},{title:"Jumlah Tindakan pengoperasian yang wajib direncanakan dalam satu periode",dataIndex:"i_target",key:"i_target",width:250,render:(e,a)=>p&&!k(a.n_indicator_item)?r.jsx(M.default,{defaultValue:e,onChange:e=>v(e.target.value,a,"i_target")}):e??""},{title:"Jumlah Tindakan Pengoperasian yang wajib dilaksanakan sesuai pedoman yang berlaku dalam satu periode",dataIndex:"i_realization",key:"i_realization",width:250,render:(e,a)=>p&&!k(a.n_indicator_item)?r.jsx(M.default,{defaultValue:e,onChange:e=>v(e.target.value,a,"i_realization")}):e??""},{title:"Presentase",key:"percentage",render:(e,a)=>{let t=a.i_target?(a.i_realization/a.i_target*100).toFixed(2):"";return t?`${t} %`:""},width:150}],dataSource:s,pagination:!1,bordered:!0,scroll:{x:"max-content"},footer:null===a?void 0:()=>r.jsx(r.Fragment,{children:r.jsx("div",{className:"text-center",children:A(a)})})})]})};var O=t(84348),K=t(87296),z=t(32653),q=t.n(z);let L=async(e,a,t,r,n,i)=>{let o=()=>{let r=t.period_month.split("_")[0],n=t.period_year.split("_")[0],i=new K.default("landscape"),o=`Periode: ${r} - ${n}`;i.setFontSize(7),i.text(o,15,10),i.setFontSize(7),i.text("Pengoperasian, Indikator Teknis",15,15);let l=Array.from({length:C()(`${n}-${r}`).daysInMonth()},(e,a)=>(a+1).toString().padStart(2,"0")),s=[{header:"Indikator Kinerja",dataKey:"indicator"},...l.map(e=>({header:e,dataKey:e}))],d=e.flatMap(e=>[{indicator:e.n_indicator,...Object.fromEntries(l.map(e=>[e,""])),_isSeparator:!0},...[{indicator:"Kerusakan yang disebabkan oleh pengoperasian yang tidak sesuai dengan ketentuan",column:"column_1"},{indicator:"Kerusakan di definisikan sebagai penyimpangan dari keadaan normal jalur KA yang mengakibatkan gangguan keterlambatan, atau pembatalan operasi",column:"column_2"}].map(t=>{let r={...t};return l.forEach(e=>{r[e]="-"}),l.forEach(n=>{a.data.forEach(a=>{C()(a.d_opr).format("DD")===n&&a.indicator.forEach(a=>{if(a.c_indicator===e.c_indicator){let e=a.sub_indicator.find(e=>e.column===t.column);e&&(r[n]=e.i_value)}})})}),r})]);q()(i,{startY:20,head:[["Indikator Kinerja",...l]],body:d.map(e=>e._isSeparator?[{content:e.indicator,colSpan:s.length}]:s.map(a=>e[a.dataKey])),styles:{fontSize:6,cellPadding:1,lineWidth:.1,lineColor:[0,0,0]},headStyles:{fontSize:6,fillColor:"#d0e5f5"},footStyles:{fontSize:6},didParseCell:e=>{let a=d[e.row.index],t=e.column.index;a._isSeparator?(e.cell.styles.halign="center",e.cell.styles.fillColor="#0d6bb5",e.cell.styles.textColor=[255,255,255]):(0===t?e.cell.styles.fillColor=[255,255,255]:"-"!==e.cell.raw&&""!==e.cell.raw?e.cell.styles.fillColor=[240,240,240]:e.cell.styles.fillColor=[255,255,255],e.cell.styles.textColor=[0,0,0]),t>0&&(e.cell.styles.halign="center")}});let c=i.lastAutoTable?.finalY||30,p=[{compliance:"Tindakan Pemeriksaan",plannedActions:"",performedActions:"",percentage:""},{compliance:"- Pemeriksaan jalur",plannedActions:"",performedActions:"",percentage:""},{compliance:"- Pemeriksaan Bangunan",plannedActions:"",performedActions:"",percentage:""},{compliance:"- Pemeriksaan Fasopka",plannedActions:"",performedActions:"",percentage:""},{compliance:"Tindakan Pengoperasian",plannedActions:"",performedActions:"",percentage:""},{compliance:"- Frekuensi Perjalanan KA Weekday",plannedActions:"",performedActions:"",percentage:""},{compliance:"- Frekuensi Perjalanan KA Weekend",plannedActions:"",performedActions:"",percentage:""}].map(e=>{let t=null;for(let r of a.summary){if(`Tindakan ${r.n_indicator}`===e.compliance){t={};break}for(let a of r.record)if(`- ${a.n_indicator_item}`===e.compliance){let e=a.i_target>0?`${(a.i_realization/a.i_target*100).toFixed(2)}%`:"0%";t={plannedActions:a.i_target,performedActions:a.i_realization,percentage:e};break}if(t)break}return{...e,...t}}),u=[{header:"Kepatuhan Pelaksanaan Pemeriksaan dan Pengoperasian",dataKey:"compliance"},{header:"Jumlah Tindakan pengoperasian yang wajib direncanakan dalam satu periode",dataKey:"plannedActions"},{header:"Jumlah Tindakan Pengoperasian yang wajib dilaksanakan sesuai pedoman yang berlaku dalam satu periode",dataKey:"performedActions"},{header:"Presentase",dataKey:"percentage"}];return q()(i,{startY:c+10,head:[u.map(e=>e.header)],body:p.map(e=>u.map(a=>e[a.dataKey])),styles:{fontSize:6,cellPadding:1,lineWidth:.1,lineColor:[0,0,0]},headStyles:{lineWidth:.1,lineColor:[0,0,0]},footStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:e=>{let a=e.column.index,t=e.row.raw;"head"===e.section?(e.cell.styles.fillColor="#0d6bb5",e.cell.styles.textColor=[255,255,255],e.cell.styles.halign="center"):(e.cell.styles.fillColor=[255,255,255],e.cell.styles.textColor=[0,0,0],("Tindakan Pemeriksaan"===t[0]||"Tindakan Pengoperasian"===t[0])&&(e.cell.styles.fontStyle="bold"),a>0&&(e.cell.styles.halign="center"))}}),i.output("arraybuffer")},l=async e=>{let a=localStorage.getItem("accessToken"),t=await fetch(e,{method:"GET",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/pdf","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw Error("Failed to fetch existing PDF");let r=Number(t.headers.get("Content-Length")),n=t.body?.getReader(),o=[],l=0;for(;;){let{done:e,value:a}=await n.read();if(e)break;o.push(a),i(Math.round((l+=a.length)/r*100))}return new Blob(o).arrayBuffer()};(async()=>{n(!0);try{let e=await o(),a=await l(r),n=t.period_month.split("_")[0],i=t.period_year.split("_")[0],s=await O.PDFDocument.load(a),d=await O.PDFDocument.load(e);(await s.copyPages(d,d.getPageIndices())).reverse().forEach(e=>{s.insertPage(0,e)});let c=await s.save(),p=new Blob([c],{type:"application/pdf"}),u=URL.createObjectURL(p),m=document.createElement("a");m.href=u,m.download=`Indikator Operasional Teknis ${i}-${n}.pdf`,m.click(),URL.revokeObjectURL(u)}catch(e){throw console.error("Error while merging PDFs",e),Error("Failed to download merged PDF")}finally{console.log("selesai download"),n(!1),i(100)}})().catch(console.error)},B=({defaultValue:e,disabled:a,onChange:t})=>r.jsx(M.default,{defaultValue:e,style:{textAlign:"center"},disabled:a,onKeyPress:e=>{let a=e.which?e.which:e.keyCode;(a<48||a>57)&&46!==a&&e.preventDefault()},onChange:e=>{let a=e.target.value;""===a&&(a="0");let r=parseFloat(a);isNaN(r)||r<0||t(a)}}),{Panel:H}=s.default,Y=()=>{let e=(0,n.useContext)(i.Z),a=(0,A.usePathname)(),[t,E]=(0,n.useState)(C()()),N=d.Z.useApp(),{message:Z,notification:I,modal:T}=N,[M,$]=(0,n.useState)(!1),[D,R]=(0,n.useState)({period_year:"",period_month:""}),[O,K]=(0,n.useState)(!1),[z,q]=(0,n.useState)([]),[Y,G]=(0,n.useState)([]),[J,W]=(0,n.useState)(!1),[V,X]=(0,n.useState)([]),[Q,ee]=(0,n.useState)(!1),[ea,et]=(0,n.useState)({}),[er,en]=(0,n.useState)(!1),[ei,eo]=(0,n.useState)([]),[el,es]=(0,n.useState)(!1),[ed,ec]=(0,n.useState)(!1),[ep,eu]=(0,n.useState)(!1),[em,eh]=(0,n.useState)(!1),[eg,e_]=(0,n.useState)(""),[ef,ey]=(0,n.useState)(""),[ex,ek]=(0,n.useState)(""),[eb,ej]=(0,n.useState)(""),[ev,eP]=(0,n.useState)(!1),[eS,ew]=(0,n.useState)(null),[eA,eE]=(0,n.useState)(0),eC=async(e,a)=>{try{K(!0);let t=await (0,w.Z)().get(`/prasarana/indicator?period_year=${e}&period_month=${a}&c_dashboard_type=PENGOPERASIAN&c_param=TEKNIS`);if((0,l.Z)({res:t,app:N})){let r=t.data;r.length?(q(r),eN(e,a)):(console.log("data not found"),q([]))}else K(!1)}catch(e){console.log("error get data master",e)}finally{K(!1)}},eN=async(e,a)=>{try{let t=await (0,w.Z)().get(`/prasarana/operation/technical?period_year=${e}&period_month=${a}`,!0);G(t.data)}catch(e){console.log("error get data operasional",e)}finally{}},eZ=async()=>{if(!V||0===V.length){console.log("Payload Save is empty");return}let e={period_month:parseInt(D.period_month,10),period_year:parseInt(D.period_year,10),data:V};try{W(!0);let a=await (0,w.Z)().post("/prasarana/operation/technical",e);(0,l.Z)({res:a,app:N})?(W(!1),Z.success("Successfully Saved"),X([])):W(!1),eC(D.period_year,D.period_month)}catch(e){console.log("error save data technical",e)}finally{W(!1),$(!1)}},eI=(e,a,t,r,n,i)=>{let o=parseInt(D.period_month,10),l=parseInt(D.period_year,10),s=["Kerusakan yang disebabkan oleh pengoperasian yang tidak sesuai dengan ketentuan","Kerusakan di definisikan sebagai penyimpangan dari keadaan normal jalur KA yang mengakibatkan gangguan keterlambatan, atau pembatalan operasi"],d=s.indexOf(t);if(-1===d){console.error("Invalid jenisGangguan");return}let c=parseFloat(i),p={d_opr:`${l}-${o}-${r}`,indicator:[{i_id:n||"",c_indicator:a,n_indicator:e,sub_indicator:s.map((e,a)=>({column:`column_${a+1}`,i_value:a===d?c:0})),i_status_active:0,n_file_path:void 0}]};X(e=>{let a=e.find(e=>e.d_opr===p.d_opr&&e.indicator[0].c_indicator===p.indicator[0].c_indicator);if(a){let e=a.indicator[0].sub_indicator.map(e=>({...e,i_value:e.column===`column_${d+1}`?c:parseFloat(e.i_value.toString())||0}));a.indicator[0].sub_indicator=e}else e.push(p);return[...e]})},eT=(0,n.useCallback)(e=>[{title:"Indikator Kinerja",dataIndex:"jenisGangguan",key:"jenisGangguan",fixed:"left",width:300},...Array.from({length:t?t.daysInMonth():30},(a,t)=>{let n;let i=String(t+1).padStart(2,"0"),o=Y.data?.find(a=>C()(a.d_opr).date()===t+1&&a.indicator.some(a=>a.c_indicator===e.c_indicator)),l=o?.indicator.find(a=>a.c_indicator===e.c_indicator)?.i_status_active;return 4===l?n="green":1===l&&(n="red"),{title:r.jsx(c.Z,{color:n,children:i}),dataIndex:i,key:i,width:100,align:"center"}})],[t,Y]),eF=async(e,a,t,r)=>{let n=t.i_id;et(e=>({...e,[r]:{loading:!0,error:!1}}));let i=new FormData;i.append("i_id",n),i.append("d_opr",e),i.append("n_file_path",a);try{let e=await (0,w.Z)({"Content-Type":"multipart/form-data"}).post("/prasarana/operation/technical/file",i);(0,l.Z)({res:e,app:N})?(Z.success("Successful Save"),et(e=>({...e,[r]:{loading:!1,error:!1}})),eC(D.period_year,D.period_month)):et(e=>({...e,[r]:{loading:!1,error:!0}}))}catch(e){console.error("Error uploading file:",e),et(e=>({...e,[r]:{loading:!1,error:!0}}))}},eM=(e,a,t)=>{eo({date:e,recordForDay:a,dateKey:t}),en(!0)},e$=e=>{let a=t?t.daysInMonth():30,n=C()().format("YYYY-MM-DD"),i=["Kerusakan yang disebabkan oleh pengoperasian yang tidak sesuai dengan ketentuan","Kerusakan di definisikan sebagai penyimpangan dari keadaan normal jalur KA yang mengakibatkan gangguan keterlambatan, atau pembatalan operasi"],o=i.map((i,o)=>{let l={key:String(o),jenisGangguan:i};for(let o=1;o<=a;o++){let a=String(o).padStart(2,"0"),s=C()(`${t.year()}-${t.month()+1}-${a}`).format("YYYY-MM-DD")>n;l[a]=M?r.jsx(B,{disabled:s,onChange:t=>{eI(e.n_indicator,e.c_indicator,i,a,"",t)}}):"-"}return l});(function(e){return e&&Array.isArray(e.data)})(Y)&&Y?.data?.forEach(a=>{a.indicator?.forEach(t=>{t.c_indicator===e.c_indicator&&t.sub_indicator?.forEach(n=>{let l=String(C()(a.d_opr).date()).padStart(2,"0"),s=i[Number(n.column.replace("column_",""))-1],d=4===t.i_status_active,c=M?r.jsx(B,{defaultValue:n.i_value,disabled:d,onChange:a=>{eI(e.n_indicator,e.c_indicator,s,l,t.i_id,a)}}):r.jsx("div",{style:{textAlign:"center"},children:n.i_value});switch(n.column){case"column_1":(M||"-"!==n.i_value)&&(o[0][l]=c);break;case"column_2":(M||"-"!==n.i_value)&&(o[1][l]=c)}})})});let l={key:"fileDokumen",jenisGangguan:"File dokumen"};for(let t=1;t<=a;t++){let a=String(t).padStart(2,"0"),n=Y.data?.find(e=>C()(e.d_opr).date()===t),i=n?.indicator.find(a=>a.c_indicator===e.c_indicator),{loading:o,error:s}=ea[a]||{loading:!1,error:!1};if(i){let e=i.n_file_path,t=null===e?r.jsx(p.default,{beforeUpload:e=>("application/pdf"!==e.type?Z.error("You can only upload PDF files!"):eF(n?.d_opr??"",e,i,a),!1),accept:"application/pdf",maxCount:1,disabled:M,children:r.jsx(u.Z,{placement:"top",title:s?"Upload gagal":"Upload file",arrow:!0,children:r.jsx(m.Z,{spinning:o,children:r.jsx("i",{className:`fa-solid fa-file-arrow-up cursor-pointer fa-lg ${s?"text-red-500":M?"text-gray-400 cursor-not-allowed":"text-[#28a745]"}`})})})}):null,d="string"==typeof e?r.jsx(r.Fragment,{children:r.jsx(u.Z,{placement:"top",title:s?"Upload gagal":"file menu",arrow:!0,children:r.jsx(m.Z,{spinning:o,children:r.jsx("i",{className:`fa-regular fa-folder-open cursor-pointer fa-lg ${s?"text-red-500":M?"text-gray-400 cursor-not-allowed":"text-[#007bff]"}`,onClick:M?void 0:()=>eM(n?.d_opr??"",i,a)})})})}):null;l[a]=(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"4px"},children:[d,t]})}else l[a]=""}o.push(l);let s={key:"actions",jenisGangguan:"Actions"};for(let t=1;t<=a;t++){let a=Y.data?.find(e=>C()(e.d_opr).date()===t),n=a?.indicator?.find(a=>a.c_indicator===e.c_indicator);if(n){let e=n.i_status_active,i=1===e?r.jsx(u.Z,{placement:"top",title:"Approve",arrow:!0,children:r.jsx(h.Z,{title:"Anda yakin untuk disetujui?",onConfirm:M?void 0:eD(n,a),onCancel:()=>null,okText:"Yes",cancelText:"No",children:r.jsx(g.ZP,{type:"link",icon:r.jsx("i",{className:`fa-solid fa-circle-check fa-lg ${M?"text-gray-400 cursor-not-allowed":""}`}),disabled:M})})}):null,o=4===e?r.jsx(u.Z,{placement:"top",title:"Unapprove",arrow:!0,children:r.jsx(h.Z,{title:"Anda yakin untuk tidak disetujui?",onConfirm:M?void 0:eR(n,a),onCancel:()=>null,okText:"Yes",cancelText:"No",children:r.jsx(g.ZP,{type:"link",icon:r.jsx("i",{className:`fa-solid fa-circle-xmark fa-lg ${M?"text-gray-400 cursor-not-allowed":"text-[#FE4545]"}`}),disabled:M})})}):null;s[String(t).padStart(2,"0")]=(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"4px"},children:[i,o]})}else s[String(t).padStart(2,"0")]=""}return o.push(s),o},eD=(e,a)=>async()=>{let{i_id:t}=e,{d_opr:r}=a;try{ee(!0);let e=await (0,w.Z)().put("/prasarana/approval",{c_dashboard_type:"PENGOPERASIAN",c_param:"TEKNIS",data:[{i_id:t,d_opr:r}]});(0,l.Z)({res:e,app:N})?(ee(!1),eC(D.period_year,D.period_month),Z.success("Successfully Approved")):ee(!1)}catch(e){console.log("error",e)}finally{ee(!1)}},eR=(e,a)=>async()=>{let{i_id:t}=e,{d_opr:r}=a;try{ee(!0);let e=await (0,w.Z)().put("/prasarana/unapproval",{c_dashboard_type:"PENGOPERASIAN",c_param:"TEKNIS",data:[{i_id:t,d_opr:r}]});(0,l.Z)({res:e,app:N})?(ee(!1),eC(D.period_year,D.period_month),Z.success("Successfully Unapproved")):ee(!1)}catch(e){console.log("error",e)}finally{ee(!1)}},eU=async()=>{try{ee(!0);let e=Y.data.flatMap(e=>e.indicator.filter(e=>1===e.i_status_active).map(a=>({i_id:a.i_id,d_opr:e.d_opr}))),a=await (0,w.Z)().put("/prasarana/approval",{c_dashboard_type:"PENGOPERASIAN",c_param:"TEKNIS",data:e});(0,l.Z)({res:a,app:N})?(ee(!1),eC(D.period_year,D.period_month),Z.success("Successfully Saved")):ee(!1)}catch(e){console.log("error",e)}finally{ee(!1)}},eO=z?.map(e=>e.c_indicator),eK=async()=>{try{ec(!0);let{period_year:e,period_month:a}=D,t=await (0,w.Z)().get(`/prasarana/operation/technical/download-merge?period_year=${e}&period_month=${a}&via_api=1`,!0);if(t&&t?.data?.message==="success"){ec(!1);let e=t.data.data.filename,{name:a,period:r,lastMerged:n}=eB(e);e_(a),ey(e),ek(r),ej(n),eh(!0)}else ec(!1),Z.error("Failed Download, File tidak tersedia")}catch(e){console.log("error download",e),ec(!1)}},ez=async()=>{eP(!0),ew(null),eE(0);try{await L(z,Y,D,ef,eP,eE)}catch(e){console.log("error download",e),ew("Gagal download file")}},eq=async()=>{try{es(!0);let{period_year:e,period_month:a}=D,t=await (0,w.Z)().get(`/prasarana/operation/technical/build-merge?period_year=${e}&period_month=${a}&via_api=1`,!0);t&&t?.data?.message==="success"?(es(!1),Z.success("Successfully Builded")):es(!1)}catch(e){console.log("error build: ",e)}finally{es(!1)}},eL=[{label:r.jsx(r.Fragment,{children:(0,r.jsxs)("div",{className:"flex gap-2 items-center",children:[r.jsx("i",{className:"fa-solid fa-gear"})," Build"]})}),key:"1",onClick:eq},{label:r.jsx(r.Fragment,{children:(0,r.jsxs)("div",{className:"flex gap-2 items-center",children:[r.jsx("i",{className:"fa-solid fa-download"})," Download"]})}),key:"2",onClick:eK}],eB=e=>{let a=e.split("/").pop();if(!a)throw Error("File not found or Invalid file path. The file name could not be extracted.");let[t,r,n]=a.split("_"),i=t.replace("%20"," "),o=r.slice(4,6),l=r.slice(0,4),s=`${o}-${l}`,d=n.slice(0,4),c=n.slice(4,6),p=n.slice(6,8),u=n.slice(8,10),m=n.slice(10,12),h=n.slice(12,14);return{name:i,period:s,lastMerged:`${p}-${c}-${d} (${u}:${m}:${h})`}},eH=Y?.data?.every(e=>e.indicator?.every(e=>4===e.i_status_active));return(0,r.jsxs)(o.Z,{pathname:a,globalState:e,children:[(0,r.jsxs)(_.Z,{className:"rounded-2xl border border-zinc-200 bg-white text-zinc-950 dark:border-zinc-800 dark:bg-zinc-950 dark:text-zinc-50 border-none w-full shadow-lg min-h-[600px]",children:[r.jsx("div",{className:"text-lg font-bold mb-3",children:"Periode"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx(f.default,{className:"mb-5",onChange:(e,a)=>{let t="",r="";if(E(e),e){R({period_year:t=`${C()(e).format("YYYY")}_${C()(e).format("YYYY")}`,period_month:r=`${C()(e).format("MM")}_${C()(e).format("MM")}`}),eC(t,r);let a=C()(e),n=C()();a.isBefore(n,"month")?eu(!0):eu(!1)}else console.log("Date is null")},picker:"month"}),z?.length?(0,r.jsxs)("div",{className:"flex gap-4",children:[ep?r.jsx(y.Z,{menu:{items:eL},disabled:M||el||ed,children:r.jsx(g.ZP,{children:r.jsx(x.Z,{children:(0,r.jsxs)(r.Fragment,{children:["File Option"," ",el||ed?r.jsx(m.Z,{size:"small"}):r.jsx("i",{className:"fa-solid fa-chevron-down"})]})})})}):null,r.jsx(g.ZP,{type:"primary",className:"mb-5",onClick:()=>{$(!M),M&&eZ()},loading:J,children:M?"Save":"Edit"}),eH?null:r.jsx(g.ZP,{type:"primary",className:"mb-5",onClick:eU,loading:Q,disabled:M,children:"Approve"})]}):null]}),O?r.jsx(k.Z,{active:!0}):(0,r.jsxs)(r.Fragment,{children:[z?.length===0?r.jsx(b.Z,{imageStyle:{height:200}}):r.jsx(s.default,{defaultActiveKey:eO,children:z.map(e=>r.jsx(H,{header:e.n_indicator,children:r.jsx(j.Z,{scroll:{x:1300},columns:eT(e),dataSource:e$(e),bordered:!0,pagination:!1})},e.c_indicator))}),z?.length===0?null:r.jsx("div",{className:"mt-10",children:r.jsx(U,{eachListTableData:Y?.summary,status:Y?.summary_status,periodeDate:D,getDataMaster:eC})})]})]}),r.jsx(F,{visible:er,onCancel:()=>{en(!1)},dataPerFile:ei,getDataMaster:eC,periodeDate:D}),r.jsx(v.Z,{title:"Konfirmasi Download",visible:em,onOk:ez,onCancel:()=>!ev&&eh(!1),okText:"Download",cancelText:"Batal",confirmLoading:ev,footer:[r.jsx(g.ZP,{onClick:()=>!ev&&eh(!1),disabled:ev,children:"Batal"},"cancel"),r.jsx(g.ZP,{type:"primary",onClick:ez,loading:ev,children:"Download"},"submit")],children:ev?(0,r.jsxs)("div",{style:{textAlign:"center"},children:[r.jsx(P.Z,{type:"circle",percent:eA,width:80}),r.jsx("p",{children:"Downloading..."})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("hr",{className:"mt-4"}),r.jsx(S.Z,{dataSource:[{label:"File",value:eg},{label:"Periode",value:ex},{label:"Last Merged",value:eb}],renderItem:e=>(0,r.jsxs)(S.Z.Item,{children:[(0,r.jsxs)("strong",{children:[e.label,":"]})," ",e.value]})}),r.jsx("hr",{className:"mb-5"}),eS&&r.jsx("p",{style:{color:"red"},children:eS})]})})]})}},97225:(e,a,t)=>{"use strict";t.r(a),t.d(a,{$$typeof:()=>o,__esModule:()=>i,default:()=>l});var r=t(68570);let n=(0,r.createProxy)(String.raw`D:\FEMBI NUR ILHAM\NUTECH\PROJECT\dashboard_executive_cms\app\(admin)\prasarana\technicIndicatorOperation\page.tsx`),{__esModule:i,$$typeof:o}=n;n.default;let l=(0,r.createProxy)(String.raw`D:\FEMBI NUR ILHAM\NUTECH\PROJECT\dashboard_executive_cms\app\(admin)\prasarana\technicIndicatorOperation\page.tsx#default`)}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[3023,9400,385,1862,7296,2653,1063,961,462,124,7619,2207,7911,4187,6400,9558,4314,3627,9899],()=>t(60717));module.exports=r})();