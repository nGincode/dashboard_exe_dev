(()=>{var e={};e.id=2859,e.ids=[2859],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},93847:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>m,tree:()=>d}),t(16585),t(20461),t(24513),t(57198),t(12742),t(39614),t(26083),t(19644),t(96560);var r=t(23191),n=t(88716),i=t(37922),l=t.n(i),o=t(95231),s={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(s[e]=()=>o[e]);t.d(a,s);let d=["",{children:["(admin)",{children:["prasarana",{children:["technicIndicatorMaintenance",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,16585)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\prasarana\\technicIndicatorMaintenance\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,20461)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,24513)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\error.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,57198)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,12742)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\not-found.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,39614)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,26083)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\error.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,19644)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\not-found.tsx"]}],c=["D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\prasarana\\technicIndicatorMaintenance\\page.tsx"],p="/(admin)/prasarana/technicIndicatorMaintenance/page",u={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/(admin)/prasarana/technicIndicatorMaintenance/page",pathname:"/prasarana/technicIndicatorMaintenance",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},56083:(e,a,t)=>{Promise.resolve().then(t.bind(t,46582))},46582:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>L});var r=t(10326),n=t(17577),i=t(20341),l=t(95425),o=t(44624),s=t(74525),d=t(34626),c=t(92379),p=t(4799),u=t(6400),m=t(21063),h=t(55113),g=t(60816),f=t(50784),x=t(91862),_=t(35285),y=t(3204),b=t(87337),j=t(75698),v=t(37619),k=t(75958),w=t(57911),S=t(97458),P=t(52279),E=t(35047),C=t(88295),N=t.n(C),Z=t(68080),I=t(40557),M=t(63191),T=t(44099);let A=({visible:e,onCancel:a,dataPerFile:t,getDataMaster:i,periodeDate:l})=>{let{date:s,recordForDay:c,dateKey:u}=t,[h,f]=(0,n.useState)({}),x=d.Z.useApp(),{message:_,notification:y,modal:b}=x;console.log("recordForDay",c);let j=async(e,t,r)=>{let n=t.i_id;console.log("recordForDay",t),f(e=>({...e,[r]:{loading:!0,error:!1}}));let d=new FormData;d.append("i_id",n),d.append("d_opr",s),d.append("n_file_path",e);try{let e=await (0,P.Z)({"Content-Type":"multipart/form-data"}).post("/prasarana/maintenance/technical/file",d);(0,o.Z)({res:e,app:x})?(_.success("Successful Save"),f(e=>({...e,[r]:{loading:!1,error:!1}})),i(l.period_year,l.period_month),a()):f(e=>({...e,[r]:{loading:!1,error:!0}}))}catch(e){console.error("Error uploading file:",e),f(e=>({...e,[r]:{loading:!1,error:!0}}))}},v=async e=>{try{let t={i_id:e.i_id};f(e=>({...e,[u]:{loading:!0,error:!1}}));let r=await (0,P.Z)().del("/prasarana/maintenance/technical/file",t);200===r.status?(f(e=>({...e,[u]:{loading:!1,error:!1}})),_.success("Successful Save"),i(l.period_year,l.period_month),a()):f(e=>({...e,[u]:{loading:!1,error:!0}}))}catch(e){console.error("Error deleting file:",e),f(e=>({...e,[u]:{loading:!1,error:!0}}))}},w=async e=>{if(!e){_.error("File tidak tersedia.");return}try{f(e=>({...e,[u]:{loading:!0,error:!1}}));let a=localStorage.getItem("accessToken"),t=await T.Z.get(e,{responseType:"blob",headers:{Authorization:`Bearer ${a}`}});if("application/json"===t.data.type){let e=new FileReader;e.onload=()=>{let a=JSON.parse(e.result);if("401"===a.code){_.error("Download failed"),f(e=>({...e,[u]:{loading:!1,error:!0}}));return}},e.readAsText(t.data);return}let r=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=r,n.setAttribute("download","file.pdf"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r),_.success("File berhasil diunduh"),f(e=>({...e,[u]:{loading:!1,error:!1}}))}catch(e){console.error("Error downloading file:",e),_.error("Gagal mengunduh file"),f(e=>({...e,[u]:{loading:!1,error:!0}}))}finally{f(e=>({...e,[u]:{loading:!1,error:!1}}))}},{loading:S,error:E}=h[u]||{loading:!1,error:!1};return(0,r.jsxs)(k.Z,{title:"File Options",visible:e,footer:null,onCancel:a,children:[r.jsx("p",{children:"Anda dapat melakukan download, upload, atau menghapus data ini."}),(0,r.jsxs)("div",{className:"mt-4 flex justify-between items-center px-8",children:[r.jsx(g.ZP,{icon:r.jsx(Z.Z,{}),type:"link",size:"large",style:{width:"120px"},disabled:S,onClick:()=>w(t?.recordForDay?.n_file_path),children:"Download"}),r.jsx(p.default,{beforeUpload:e=>("application/pdf"!==e.type?_.error("You can only upload PDF files!"):j(e,c,u),!1),showUploadList:!1,maxCount:1,accept:"application/pdf",children:r.jsx(g.ZP,{icon:r.jsx(I.Z,{}),type:"link",size:"large",disabled:S,style:{width:"120px"},children:r.jsx("span",{children:"Upload"})})}),r.jsx(g.ZP,{danger:!0,disabled:S,icon:r.jsx(M.Z,{}),size:"large",type:"link",style:{width:"120px"},onClick:()=>v(c),children:"Delete"})]}),S&&r.jsx(m.Z,{spinning:S,children:"Processing..."}),E&&r.jsx("p",{style:{color:"red"},children:"Error: Upload gagal."})]})};var F=t(84348),D=t(87296),U=t(32653),$=t.n(U);let R=async(e,a,t,r,n,i)=>{let l=()=>{let r=t.period_month.split("_")[0],n=t.period_year.split("_")[0],i=new D.default("landscape"),l=`Periode: ${r} - ${n}`;i.setFontSize(7),i.text(l,15,10),i.setFontSize(7),i.text("Perawatan, Indikator Teknis",15,15);let o=Array.from({length:N()(`${n}-${r}`).daysInMonth()},(e,a)=>(a+1).toString().padStart(2,"0")),s=[{header:"Indikator Kinerja",dataKey:"indicator"},...o.map(e=>({header:e,dataKey:e}))],d=e.flatMap(e=>[{indicator:e.n_indicator,...Object.fromEntries(o.map(e=>[e,""])),_isSeparator:!0},...[{indicator:"Perawatan yang tidak sesuai Standar Teknis dan SOP",column:"column_1"},{indicator:"Perawatan yang terlambat dilakukan",column:"column_2"},{indicator:"Kerusakan yang mengakibatkan Kerusakan di definisikan sebagai penyimpangan dari keadaan normal jalur KA yang mengakibatkan gangguan keterlambatan, atau pembatalan operasi",column:"column_3"}].map(t=>{let r={...t};return o.forEach(e=>{r[e]="-"}),o.forEach(n=>{a.forEach(a=>{N()(a.d_opr).format("DD")===n&&a.indicator.forEach(a=>{if(a.c_indicator===e.c_indicator){let e=a.sub_indicator.find(e=>e.column===t.column);e&&(r[n]=e.i_value)}})})}),r})]);return $()(i,{startY:20,head:[["Indikator Kinerja",...o]],body:d.map(e=>e._isSeparator?[{content:e.indicator,colSpan:s.length}]:s.map(a=>e[a.dataKey])),styles:{fontSize:6,cellPadding:1,lineWidth:.1,lineColor:[0,0,0]},headStyles:{fontSize:6,fillColor:"#d0e5f5"},footStyles:{fontSize:6},didParseCell:e=>{let a=d[e.row.index],t=e.column.index;a._isSeparator?(e.cell.styles.halign="center",e.cell.styles.fillColor="#0d6bb5",e.cell.styles.textColor=[255,255,255]):(0===t?e.cell.styles.fillColor=[255,255,255]:"-"!==e.cell.raw&&""!==e.cell.raw?e.cell.styles.fillColor=[240,240,240]:e.cell.styles.fillColor=[255,255,255],e.cell.styles.textColor=[0,0,0]),t>0&&(e.cell.styles.halign="center")},didDrawPage:()=>{i.setFontSize(8),i.internal.pages.length}}),i.output("arraybuffer")},o=async e=>{let a=localStorage.getItem("accessToken"),t=await fetch(e,{method:"GET",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/pdf","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw Error("Failed to fetch existing PDF");let r=Number(t.headers.get("Content-Length")),n=t.body?.getReader(),l=[],o=0;for(;;){let{done:e,value:a}=await n.read();if(e)break;l.push(a),i(Math.round((o+=a.length)/r*100))}return new Blob(l).arrayBuffer()},s=async()=>{n(!0);try{let e=await l(),a=await o(r),n=t.period_month.split("_")[0],i=t.period_year.split("_")[0],s=await F.PDFDocument.load(a),d=await F.PDFDocument.load(e);(await s.copyPages(d,d.getPageIndices())).reverse().forEach(e=>{s.insertPage(0,e)});let c=await s.save(),p=new Blob([c],{type:"application/pdf"}),u=URL.createObjectURL(p),m=document.createElement("a");m.href=u,m.download=`Indikator Perawatan Teknis ${i}-${n}.pdf`,m.click(),URL.revokeObjectURL(u)}catch(e){throw console.error("Error while merging PDFs",e),Error("Failed to download merged PDF")}finally{console.log("selesai download"),n(!1),i(100)}};await s()};var q=t(59270);let O=({defaultValue:e,disabled:a,onChange:t})=>r.jsx(q.default,{defaultValue:e,style:{textAlign:"center"},disabled:a,onKeyPress:e=>{let a=e.which?e.which:e.keyCode;(a<48||a>57)&&46!==a&&e.preventDefault()},onChange:e=>{let a=e.target.value;""===a&&(a="0");let r=parseFloat(a);isNaN(r)||r<0||t(a)}}),{Panel:H}=s.default,L=()=>{let e=(0,n.useContext)(i.Z),a=(0,E.usePathname)(),[t,C]=(0,n.useState)(N()()),Z=d.Z.useApp(),{message:I,notification:M,modal:T}=Z,[F,D]=(0,n.useState)(!1),[U,$]=(0,n.useState)({period_year:"",period_month:""}),[q,L]=(0,n.useState)(!1),[B,Y]=(0,n.useState)([]),[K,z]=(0,n.useState)([]),[J,G]=(0,n.useState)(!1),[W,X]=(0,n.useState)([]),[V,Q]=(0,n.useState)(!1),[ee,ea]=(0,n.useState)({}),[et,er]=(0,n.useState)(!1),[en,ei]=(0,n.useState)([]),[el,eo]=(0,n.useState)(!1),[es,ed]=(0,n.useState)(!1),[ec,ep]=(0,n.useState)(!1),[eu,em]=(0,n.useState)(!1),[eh,eg]=(0,n.useState)(""),[ef,ex]=(0,n.useState)(""),[e_,ey]=(0,n.useState)(""),[eb,ej]=(0,n.useState)(""),[ev,ek]=(0,n.useState)(!1),[ew,eS]=(0,n.useState)(null),[eP,eE]=(0,n.useState)(0),eC=async(e,a)=>{try{L(!0);let t=await (0,P.Z)().get(`/prasarana/indicator?period_year=${e}&period_month=${a}&c_dashboard_type=PERAWATAN&c_param=TEKNIS`);if((0,o.Z)({res:t,app:Z})){let r=t.data;r.length?(Y(r),eN(e,a)):(console.log("data not found"),Y([]))}else L(!1)}catch(e){console.log("error get data master",e)}finally{L(!1)}},eN=async(e,a)=>{try{let t=await (0,P.Z)().get(`/prasarana/maintenance/technical?period_year=${e}&period_month=${a}`,!0);z(t.data)}catch(e){console.log("error get data operasional",e)}finally{}},eZ=async()=>{if(!W||0===W.length){console.log("Payload Save is empty");return}let e={period_month:parseInt(U.period_month,10),period_year:parseInt(U.period_year,10),data:W};try{G(!0);let a=await (0,P.Z)().post("/prasarana/maintenance/technical",e);(0,o.Z)({res:a,app:Z})?(G(!1),I.success("Successfully Saved"),X([])):G(!1),eC(U.period_year,U.period_month)}catch(e){console.log("error save data technical",e)}finally{G(!1),D(!1)}},eI=(e,a,t,r,n,i)=>{let l=parseInt(U.period_month,10),o=parseInt(U.period_year,10),s=["Perawatan yang tidak sesuai Standar Teknis dan SOP","Perawatan yang terlambat dilakukan","Kerusakan di definisikan sebagai penyimpangan dari keadaan normal jalur KA yang mengakibatkan gangguan keterlambatan, atau pembatalan operasi"],d=s.indexOf(t);if(-1===d){console.error("Invalid jenisGangguan");return}let c=parseFloat(i),p={d_opr:`${o}-${l}-${r}`,indicator:[{i_id:n||"",c_indicator:a,n_indicator:e,sub_indicator:s.map((e,a)=>({column:`column_${a+1}`,i_value:a===d?c:0})),i_status_active:0,n_file_path:void 0}]};X(e=>{let a=e.find(e=>e.d_opr===p.d_opr&&e.indicator[0].c_indicator===p.indicator[0].c_indicator);if(a){let e=a.indicator[0].sub_indicator.map(e=>({...e,i_value:e.column===`column_${d+1}`?c:parseFloat(e.i_value.toString())||0}));a.indicator[0].sub_indicator=e}else e.push(p);return[...e]})},eM=(0,n.useCallback)(e=>[{title:"Indikator Kinerja",dataIndex:"jenisGangguan",key:"jenisGangguan",fixed:"left",width:300},...Array.from({length:t?t.daysInMonth():30},(a,t)=>{let n;let i=String(t+1).padStart(2,"0"),l=K.data?.find(a=>N()(a.d_opr).date()===t+1&&a.indicator.some(a=>a.c_indicator===e.c_indicator)),o=l?.indicator.find(a=>a.c_indicator===e.c_indicator)?.i_status_active;return 4===o?n="green":1===o&&(n="red"),{title:r.jsx(c.Z,{color:n,children:i}),dataIndex:i,key:i,width:100,align:"center"}})],[t,K]),eT=async(e,a,t,r)=>{let n=t.i_id;ea(e=>({...e,[r]:{loading:!0,error:!1}}));let i=new FormData;i.append("i_id",n),i.append("d_opr",e),i.append("n_file_path",a);try{let e=await (0,P.Z)({"Content-Type":"multipart/form-data"}).post("/prasarana/maintenance/technical/file",i);(0,o.Z)({res:e,app:Z})?(I.success("Successfully Saved"),ea(e=>({...e,[r]:{loading:!1,error:!1}})),eC(U.period_year,U.period_month)):ea(e=>({...e,[r]:{loading:!1,error:!0}}))}catch(e){console.error("Error uploading file:",e),ea(e=>({...e,[r]:{loading:!1,error:!0}}))}},eA=(e,a,t)=>{ei({date:e,recordForDay:a,dateKey:t}),er(!0)},eF=e=>{let a=t?t.daysInMonth():30,n=N()().format("YYYY-MM-DD"),i=["Perawatan yang tidak sesuai Standar Teknis dan SOP","Perawatan yang terlambat dilakukan","Kerusakan di definisikan sebagai penyimpangan dari keadaan normal jalur KA yang mengakibatkan gangguan keterlambatan, atau pembatalan operasi"],l=i.map((i,l)=>{let o={key:String(l),jenisGangguan:i};for(let l=1;l<=a;l++){let a=String(l).padStart(2,"0"),s=N()(`${t.year()}-${t.month()+1}-${a}`).format("YYYY-MM-DD")>n;o[a]=F?r.jsx(O,{disabled:s,onChange:t=>{eI(e.n_indicator,e.c_indicator,i,a,"",t)}}):"-"}return o});(function(e){return e&&Array.isArray(e.data)})(K)&&K?.data?.forEach(a=>{a.indicator?.forEach(t=>{t.c_indicator===e.c_indicator&&t.sub_indicator?.forEach(n=>{let o=String(N()(a.d_opr).date()).padStart(2,"0"),s=i[Number(n.column.replace("column_",""))-1],d=4===t.i_status_active,c=F?r.jsx(O,{defaultValue:n.i_value,disabled:d,onChange:a=>{eI(e.n_indicator,e.c_indicator,s,o,t.i_id,a)}}):r.jsx("div",{style:{textAlign:"center"},children:n.i_value});switch(n.column){case"column_1":(F||"-"!==n.i_value)&&(l[0][o]=c);break;case"column_2":(F||"-"!==n.i_value)&&(l[1][o]=c);break;case"column_3":(F||"-"!==n.i_value)&&(l[2][o]=c)}})})});let o={key:"fileDokumen",jenisGangguan:"File dokumen"};for(let t=1;t<=a;t++){let a=String(t).padStart(2,"0"),n=K.data?.find(e=>N()(e.d_opr).date()===t),i=n?.indicator.find(a=>a.c_indicator===e.c_indicator),{loading:l,error:s}=ee[a]||{loading:!1,error:!1};if(i){let e=i.n_file_path,t=null===e?r.jsx(p.default,{beforeUpload:e=>("application/pdf"!==e.type?I.error("You can only upload PDF files!"):eT(n?.d_opr??"",e,i,a),!1),accept:"application/pdf",maxCount:1,disabled:F,children:r.jsx(u.Z,{placement:"top",title:s?"Upload gagal":"Upload file",arrow:!0,children:r.jsx(m.Z,{spinning:l,children:r.jsx("i",{className:`fa-solid fa-file-arrow-up cursor-pointer fa-lg ${s?"text-red-500":F?"text-gray-400 cursor-not-allowed":"text-[#28a745]"}`})})})}):null,d="string"==typeof e?r.jsx(r.Fragment,{children:r.jsx(u.Z,{placement:"top",title:s?"Upload gagal":"file menu",arrow:!0,children:r.jsx(m.Z,{spinning:l,children:r.jsx("i",{className:`fa-regular fa-folder-open cursor-pointer fa-lg ${s?"text-red-500":F?"text-gray-400 cursor-not-allowed":"text-[#007bff]"}`,onClick:F?void 0:()=>eA(n?.d_opr??"",i,a)})})})}):null;o[a]=(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"4px"},children:[d,t]})}else o[a]=""}l.push(o);let s={key:"actions",jenisGangguan:"Actions"};for(let t=1;t<=a;t++){let a=K.data?.find(e=>N()(e.d_opr).date()===t),n=a?.indicator?.find(a=>a.c_indicator===e.c_indicator);if(n){let e=n.i_status_active,i=1===e?r.jsx(u.Z,{placement:"top",title:"Approve",arrow:!0,children:r.jsx(h.Z,{title:"Anda yakin untuk disetujui?",onConfirm:F?void 0:eD(n,a),onCancel:()=>null,okText:"Yes",cancelText:"No",children:r.jsx(g.ZP,{type:"link",icon:r.jsx("i",{className:`fa-solid fa-circle-check fa-lg ${F?"text-gray-400 cursor-not-allowed":""}`}),disabled:F})})}):null,l=4===e?r.jsx(u.Z,{placement:"top",title:"Unapprove",arrow:!0,children:r.jsx(h.Z,{title:"Anda yakin untuk tidak disetujui?",onConfirm:F?void 0:eU(n,a),onCancel:()=>null,okText:"Yes",cancelText:"No",children:r.jsx(g.ZP,{type:"link",icon:r.jsx("i",{className:`fa-solid fa-circle-xmark fa-lg ${F?"text-gray-400 cursor-not-allowed":"text-[#FE4545]"}`}),disabled:F})})}):null;s[String(t).padStart(2,"0")]=(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"4px"},children:[i,l]})}else s[String(t).padStart(2,"0")]=""}return l.push(s),l},eD=(e,a)=>async()=>{let{i_id:t}=e,{d_opr:r}=a;try{Q(!0);let e=await (0,P.Z)().put("/prasarana/approval",{c_dashboard_type:"PERAWATAN",c_param:"TEKNIS",data:[{i_id:t,d_opr:r}]});(0,o.Z)({res:e,app:Z})?(Q(!1),eC(U.period_year,U.period_month),I.success("Successfully Approved")):Q(!1)}catch(e){console.log("error",e)}finally{Q(!1)}},eU=(e,a)=>async()=>{let{i_id:t}=e,{d_opr:r}=a;try{Q(!0);let e=await (0,P.Z)().put("/prasarana/unapproval",{c_dashboard_type:"PERAWATAN",c_param:"TEKNIS",data:[{i_id:t,d_opr:r}]});(0,o.Z)({res:e,app:Z})?(Q(!1),eC(U.period_year,U.period_month),I.success("Successfully Unapproved")):Q(!1)}catch(e){console.log("error",e)}finally{Q(!1)}},e$=async()=>{try{Q(!0);let e=K.data.flatMap(e=>e.indicator.filter(e=>1===e.i_status_active).map(a=>({i_id:a.i_id,d_opr:e.d_opr}))),a=await (0,P.Z)().put("/prasarana/approval",{c_dashboard_type:"PERAWATAN",c_param:"TEKNIS",data:e});(0,o.Z)({res:a,app:Z})?(Q(!1),eC(U.period_year,U.period_month),I.success("Successfully Saved")):Q(!1)}catch(e){console.log("error",e)}finally{Q(!1)}},eR=B?.map(e=>e.c_indicator),eq=async()=>{try{eo(!0);let{period_year:e,period_month:a}=U,t=await (0,P.Z)().get(`/prasarana/maintenance/technical/download-merge?period_year=${e}&period_month=${a}&via_api=1`,!0);if(t&&t?.data?.message==="success"){eo(!1);let e=t.data.data.filename,{name:a,period:r,lastMerged:n}=eO(e);eg(a),ex(e),ey(r),ej(n),em(!0)}else eo(!1),I.error("Failed Download, File tidak tersedia")}catch(e){console.log("error download",e),eo(!1)}},eO=e=>{let a=e.split("/").pop();if(!a)throw Error("File not found or Invalid file path. The file name could not be extracted.");let[t,r,n]=a.split("_"),i=t.replace("%20"," "),l=r.slice(4,6),o=r.slice(0,4),s=`${l}-${o}`,d=n.slice(0,4),c=n.slice(4,6),p=n.slice(6,8),u=n.slice(8,10),m=n.slice(10,12),h=n.slice(12,14);return{name:i,period:s,lastMerged:`${p}-${c}-${d} (${u}:${m}:${h})`}},eH=async()=>{ek(!0),eS(null),eE(0);try{await R(B,K?.data,U,ef,ek,eE)}catch(e){console.log("Error during download",e),eS("Gagal download file")}},eL=async()=>{try{ed(!0);let{period_year:e,period_month:a}=U,t=await (0,P.Z)().get(`/prasarana/maintenance/technical/build-merge?period_year=${e}&period_month=${a}&via_api=1`,!0);t&&t?.data?.message==="success"?(ed(!1),I.success("Successfully Builded")):ed(!1)}catch(e){console.log("error build: ",e)}finally{ed(!1)}},eB=[{label:r.jsx(r.Fragment,{children:(0,r.jsxs)("div",{className:"flex gap-2 items-center",children:[r.jsx("i",{className:"fa-solid fa-gear"})," Build"]})}),key:"1",onClick:eL},{label:r.jsx(r.Fragment,{children:(0,r.jsxs)("div",{className:"flex gap-2 items-center",children:[r.jsx("i",{className:"fa-solid fa-download"})," Download"]})}),key:"2",onClick:eq}],eY=K?.data?.every(e=>e.indicator?.every(e=>4===e.i_status_active));return(0,r.jsxs)(l.Z,{pathname:a,globalState:e,children:[(0,r.jsxs)(f.Z,{className:"rounded-2xl border border-zinc-200 bg-white text-zinc-950 dark:border-zinc-800 dark:bg-zinc-950 dark:text-zinc-50 border-none w-full shadow-lg min-h-[600px]",children:[r.jsx("div",{className:"text-lg font-bold mb-3",children:"Periode"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx(x.default,{className:"mb-5",onChange:(e,a)=>{let t="",r="";if(C(e),e){$({period_year:t=`${N()(e).format("YYYY")}_${N()(e).format("YYYY")}`,period_month:r=`${N()(e).format("MM")}_${N()(e).format("MM")}`}),eC(t,r);let a=N()(e),n=N()();a.isBefore(n,"month")?ep(!0):ep(!1)}else console.log("Date is null")},picker:"month"}),B?.length?(0,r.jsxs)("div",{className:"flex gap-4",children:[ec?r.jsx(_.Z,{menu:{items:eB},disabled:F||es||el,children:r.jsx(g.ZP,{children:r.jsx(y.Z,{children:(0,r.jsxs)(r.Fragment,{children:["File Option"," ",es||el?r.jsx(m.Z,{size:"small"}):r.jsx("i",{className:"fa-solid fa-chevron-down"})]})})})}):null,r.jsx(g.ZP,{type:"primary",className:"mb-5",onClick:()=>{D(!F),F&&eZ()},loading:J,children:F?"Save":"Edit"}),eY?null:r.jsx(g.ZP,{type:"primary",className:"mb-5",onClick:e$,loading:V,disabled:F,children:"Approve"})]}):null]}),q?r.jsx(b.Z,{active:!0}):r.jsx(r.Fragment,{children:B?.length===0?r.jsx(j.Z,{imageStyle:{height:200}}):r.jsx(s.default,{defaultActiveKey:eR,children:B.map(e=>r.jsx(H,{header:e.n_indicator,children:r.jsx(v.Z,{scroll:{x:1300},columns:eM(e),dataSource:eF(e),bordered:!0,pagination:!1})},e.c_indicator))})})]}),r.jsx(A,{visible:et,onCancel:()=>{er(!1)},dataPerFile:en,getDataMaster:eC,periodeDate:U}),r.jsx(k.Z,{title:"Konfirmasi Download",visible:eu,onOk:eH,onCancel:()=>!ev&&em(!1),okText:"Download",cancelText:"Batal",confirmLoading:ev,footer:[r.jsx(g.ZP,{onClick:()=>!ev&&em(!1),disabled:ev,children:"Batal"},"cancel"),r.jsx(g.ZP,{type:"primary",onClick:eH,loading:ev,children:"Download"},"submit")],children:ev?(0,r.jsxs)("div",{style:{textAlign:"center"},children:[r.jsx(w.Z,{type:"circle",percent:eP,width:80}),r.jsx("p",{children:"Downloading..."})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("hr",{className:"mt-4"}),r.jsx(S.Z,{dataSource:[{label:"File",value:eh},{label:"Periode",value:e_},{label:"Last Merged",value:eb}],renderItem:e=>(0,r.jsxs)(S.Z.Item,{children:[(0,r.jsxs)("strong",{children:[e.label,":"]})," ",e.value]})}),r.jsx("hr",{className:"mb-5"}),ew&&r.jsx("p",{style:{color:"red"},children:ew})]})})]})}},16585:(e,a,t)=>{"use strict";t.r(a),t.d(a,{$$typeof:()=>l,__esModule:()=>i,default:()=>o});var r=t(68570);let n=(0,r.createProxy)(String.raw`D:\FEMBI NUR ILHAM\NUTECH\PROJECT\dashboard_executive_cms\app\(admin)\prasarana\technicIndicatorMaintenance\page.tsx`),{__esModule:i,$$typeof:l}=n;n.default;let o=(0,r.createProxy)(String.raw`D:\FEMBI NUR ILHAM\NUTECH\PROJECT\dashboard_executive_cms\app\(admin)\prasarana\technicIndicatorMaintenance\page.tsx#default`)}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[3023,9400,385,1862,7296,2653,1063,961,462,124,7619,2207,7911,4187,6400,9558,4314,3627,9899],()=>t(93847));module.exports=r})();