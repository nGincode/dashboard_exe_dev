(()=>{var e={};e.id=5343,e.ids=[5343],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},23919:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>s.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>l,routeModule:()=>_,tree:()=>c}),t(68752),t(20461),t(24513),t(57198),t(12742),t(39614),t(26083),t(19644),t(96560);var r=t(23191),i=t(88716),n=t(37922),s=t.n(n),o=t(95231),d={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);t.d(a,d);let c=["",{children:["(admin)",{children:["prasarana",{children:["operationalIndicatorMaintenance",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,68752)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\prasarana\\operationalIndicatorMaintenance\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,20461)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,24513)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\error.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,57198)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,12742)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\not-found.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,39614)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,26083)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\error.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,19644)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\not-found.tsx"]}],l=["D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\prasarana\\operationalIndicatorMaintenance\\page.tsx"],p="/(admin)/prasarana/operationalIndicatorMaintenance/page",u={require:t,loadChunk:()=>Promise.resolve()},_=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(admin)/prasarana/operationalIndicatorMaintenance/page",pathname:"/prasarana/operationalIndicatorMaintenance",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},75675:(e,a,t)=>{Promise.resolve().then(t.bind(t,73827))},73827:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>N});var r=t(10326),i=t(17577),n=t(95425),s=t(20341),o=t(44624),d=t(35047),c=t(74525),l=t(34626),p=t(59270),u=t(6400),_=t(55113),m=t(60816),x=t(46752),h=t(92379),g=t(37619),f=t(50784),y=t(91862),v=t(87337),b=t(75698),E=t(88295),P=t.n(E),I=t(52279);let M=(e,a)=>{let t=String(a).padStart(2,"0");return Array.from({length:P()(`${e}-${t}`).daysInMonth()},(a,r)=>P()(`${e}-${t}-${r+1}`).format("YYYY-MM-DD"))},A=({data:e,isEditable:a,handleInputChange:t,periodeDate:n,getDataMaster:s})=>{let[d,f]=(0,i.useState)(!1),[y,v]=(0,i.useState)(!1),{Panel:b}=c.default,E=parseInt(n.period_year,10),A=parseInt(n.period_month,10),N=P()().format("YYYY-MM-DD"),j=l.Z.useApp(),T=(0,i.useMemo)(()=>M(E,A),[E,A]),C=[{title:"Tanggal Operasi",dataIndex:"d_opr",key:"d_opr"},{title:"Jangka Waktu Operasi Pelayanan KA (menit)",dataIndex:"i_operation_time",key:"i_operation_time",render:(e,i)=>a&&i.d_opr<=N&&4!==i.i_status_active?r.jsx(p.default,{type:"number",min:0,defaultValue:"-"===e?"":e,onChange:e=>t(i.n_indicator,i.c_indicator,i.d_opr,"i_operation_time",e.target.value,i.i_id)}):r.jsx(r.Fragment,{children:i.d_opr<=N?e:r.jsx(r.Fragment,{children:a?r.jsx(p.default,{disabled:!0}):e})})},{title:"Jangka Waktu Operasi yang Terganggu (menit)",dataIndex:"i_operation_time_disturb",key:"i_operation_time_disturb",render:(e,i)=>a&&i.d_opr<=N&&4!==i.i_status_active?r.jsx(p.default,{type:"number",min:0,defaultValue:"-"===e?"":e,onChange:e=>t(i.n_indicator,i.c_indicator,i.d_opr,"i_operation_time_disturb",e.target.value,i.i_id)}):r.jsx(r.Fragment,{children:i.d_opr<=N?e:r.jsx(r.Fragment,{children:a?r.jsx(p.default,{disabled:!0}):e})})},{title:"Presentase",dataIndex:"i_percentage",key:"i_percentage",render:e=>r.jsx(r.Fragment,{children:"-"===e?"-":`${e} %`})},{title:"Status",dataIndex:"i_status_active",key:"i_status_active",align:"center",render:e=>S(e)},{title:"Aksi",dataIndex:"i_status_active",key:"action",align:"center",render:(e,t)=>1===t.i_status_active?r.jsx(u.Z,{placement:"rightTop",title:"Approve",arrow:!0,children:r.jsx(_.Z,{title:"Anda yakin untuk disetujui?",onConfirm:k(t),onCancel:()=>null,okText:"Yes",cancelText:"No",children:r.jsx(m.ZP,{size:"small",type:"link",shape:"circle",icon:r.jsx("i",{className:"fa-solid fa-circle-check fa-2x"}),disabled:a})})}):4===t.i_status_active?r.jsx(u.Z,{placement:"rightTop",title:"Unapprove",arrow:!0,children:r.jsx(_.Z,{title:"Anda yakin untuk tidak disetujui?",onConfirm:R(t),onCancel:()=>null,okText:"Yes",cancelText:"No",children:r.jsx(m.ZP,{size:"small",type:"link",shape:"circle",icon:r.jsx("i",{className:"fa-solid fa-circle-xmark fa-2x text-[#FE4545]"}),disabled:a})})}):null}],k=e=>async()=>{try{v(!0);let a={c_dashboard_type:"PERAWATAN",c_param:"OPERASIONAL",data:[{i_id:e.i_id,d_opr:e.d_opr}]},t=await (0,I.Z)().put("/prasarana/approval",a);(0,o.Z)({res:t,app:j})?(f(!1),s(`${E}_${E}`,`${A}_${A}`),x.ZP.success("Successful Save")):f(!1)}catch(e){console.log("error",e)}finally{v(!1)}},R=e=>async()=>{try{f(!0);let a={c_dashboard_type:"PERAWATAN",c_param:"OPERASIONAL",data:[{i_id:e.i_id,d_opr:e.d_opr}]},t=await (0,I.Z)().put("/prasarana/unapproval",a);(0,o.Z)({res:t,app:j})?(f(!1),s(`${E}_${E}`,`${A}_${A}`),x.ZP.success("Successful Save")):f(!1)}catch(e){console.log("error",e)}finally{f(!1)}},S=e=>{if("-"===e)return"-";let a="default",t="-";switch(e){case 1:a="blue",t="Ready to Approve";break;case 4:a="green",t="Approve";break;default:a="default",t="-"}return r.jsx(h.Z,{color:a,children:t})},Z=e?.map(e=>e.c_indicator);return r.jsx(c.default,{defaultActiveKey:Z,children:e.map(e=>{let a=T.map(a=>{let t=e.record.find(e=>e.d_opr===a);return{...t,n_indicator:e.n_indicator,c_indicator:e.c_indicator,i_id:t?.i_id??"",d_opr:a,i_operation_time:t?.i_operation_time??"-",i_operation_time_disturb:t?.i_operation_time_disturb??"-",i_percentage:t?.i_percentage??"-",i_status_active:t?.i_status_active??"-"}});return r.jsx(b,{header:e.n_indicator,children:r.jsx(g.Z,{columns:C,dataSource:a,rowKey:"d_opr",pagination:!1,bordered:!0,scroll:{x:"max-content"}})},e.c_indicator)})})},N=()=>{let e=(0,i.useContext)(s.Z),a=(0,d.usePathname)(),[t,c]=(0,i.useState)(null),[p,u]=(0,i.useState)(!1),[_,x]=(0,i.useState)([]),[h,g]=(0,i.useState)({period_year:"",period_month:""}),[E,M]=(0,i.useState)(!1),[N,j]=(0,i.useState)(!1),[T,C]=(0,i.useState)(!1),[k,R]=(0,i.useState)([]),[S,Z]=(0,i.useState)(null),[U,q]=(0,i.useState)(!1),H=l.Z.useApp(),{message:$,notification:O,modal:w}=H,D=async(e,a)=>{try{C(!0);let t=await (0,I.Z)().get(`/prasarana/master/target?period_year=${e}&period_month=${a}&c_dashboard_type=PERAWATAN`);if((0,o.Z)({res:t,app:H})){let r=t.data[0].data.find(e=>"Operasional"===e.n_param);if(r){let t={...r,record:r.record.map(e=>{let{i_target:a,i_order:t,i_status_active:r,...i}=e;return i})};F(e,a,t)}else console.log("data not found"),R([])}else C(!1)}catch(e){console.log("error get data master",e),R([])}finally{C(!1)}},F=async(e,a,t)=>{try{C(!0);let r=await (0,I.Z)().get(`/prasarana/maintenance/operational?period_year=${e}&period_month=${a}`,!0),i=new Map(r.data.data.map(e=>[e.c_indicator,e])),n=t.record.map(e=>{let a=i.get(e.c_indicator);return a?{...e,record:a.record}:{...e,record:[]}});R(n)}catch(e){Z(e),console.log("error get data operasional",e)}finally{C(!1)}},Y=async()=>{if(0===_.length){console.log("Tidak ada perubahan yang disimpan");return}let e=_.reduce((e,a)=>{let{n_indicator:t,c_indicator:r,i_id:i,d_opr:n,i_operation_time:s,i_operation_time_disturb:o}=a,d=e.find(e=>e.n_indicator===t);d||(d={n_indicator:t,c_indicator:r,record:[]},e.push(d));let c=d.record.findIndex(e=>e.i_id===i&&e.d_opr===n),l={i_id:i,d_opr:n,i_operation_time:void 0!==s?Number(s):0,i_operation_time_disturb:void 0!==o?Number(o):0};return -1!==c?d.record[c]={...d.record[c],...l}:d.record.push(l),e},[]),a={period_year:parseInt(h.period_year,10),period_month:parseInt(h.period_month,10),data:e};try{q(!0);let e=await (0,I.Z)().post("/prasarana/maintenance/operational",a);(0,o.Z)({res:e,app:H})?(q(!1),x([]),$.success("Successful Save")):(x([]),q(!1)),D(h.period_year,h.period_month),u(!1)}catch(e){console.log("error save data operasional",e)}finally{q(!1)}},L=async()=>{try{j(!0);let e={c_dashboard_type:"PERAWATAN",c_param:"OPERASIONAL",data:[]};k.forEach(a=>{a.record.filter(e=>1===e.i_status_active).forEach(a=>{e.data.push({i_id:a.i_id,d_opr:a.d_opr})})});let a=await (0,I.Z)().put("/prasarana/approval",e);(0,o.Z)({res:a,app:H})?(j(!1),D(h.period_year,h.period_month),$.success("Successful Save")):j(!1)}catch(e){console.log("error",e)}finally{j(!1)}};return r.jsx(n.Z,{pathname:a,globalState:e,children:(0,r.jsxs)(f.Z,{className:"rounded-2xl border border-zinc-200 bg-white text-zinc-950 dark:border-zinc-800 dark:bg-zinc-950 dark:text-zinc-50 border-none w-full shadow-lg min-h-[600px]",children:[r.jsx("div",{className:"text-lg font-bold mb-3",children:"Periode"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx(y.default,{className:"mb-5",onChange:(e,a)=>{let t="",r="";c(e),e?(g({period_year:t=`${P()(e).format("YYYY")}_${P()(e).format("YYYY")}`,period_month:r=`${P()(e).format("MM")}_${P()(e).format("MM")}`}),D(t,r)):console.log("Date is null")},picker:"month"}),k.length?(0,r.jsxs)("div",{className:"flex gap-4",children:[r.jsx(m.ZP,{onClick:()=>{u(!p),p&&Y()},type:"primary",className:"mb-5",loading:U,children:p?"Save":"Edit"}),(e=>{for(let a of e)for(let e of a?.record)if(e?.i_status_active!==4)return!1;return!0})(k)?null:r.jsx(m.ZP,{type:"primary",onClick:L,loading:N,disabled:p,children:"Approve"})]}):null]}),T?r.jsx(v.Z,{active:!0}):r.jsx(r.Fragment,{children:k.length?S?(0,r.jsxs)("div",{children:["Error: ",S.message]}):r.jsx(A,{data:k,isEditable:p,handleInputChange:(e,a,t,r,i,n)=>{R(a=>a.map(a=>a.n_indicator===e?{...a,record:a.record.map(e=>e.d_opr===t?{...e,[r]:i}:e)}:a)),x(s=>{let o=s.findIndex(r=>r.n_indicator===e&&r.c_indicator===a&&r.d_opr===t&&r.i_id===n);if(-1!==o){let e=[...s];return e[o]={...e[o],[r]:i},e}{let o=k.find(a=>a.n_indicator===e)?.record.find(e=>e.d_opr===t);return[...s,{i_id:n,d_opr:t,n_indicator:e,c_indicator:a,i_operation_time:o?.i_operation_time||"",i_operation_time_disturb:o?.i_operation_time_disturb||"",i_percentage:o?.i_percentage||"",i_status_active:o?.i_status_active||"",[r]:i}]}})},periodeDate:h,getDataMaster:D}):r.jsx(b.Z,{imageStyle:{height:200}})})]})})}},68752:(e,a,t)=>{"use strict";t.r(a),t.d(a,{$$typeof:()=>s,__esModule:()=>n,default:()=>o});var r=t(68570);let i=(0,r.createProxy)(String.raw`D:\FEMBI NUR ILHAM\NUTECH\PROJECT\dashboard_executive_cms\app\(admin)\prasarana\operationalIndicatorMaintenance\page.tsx`),{__esModule:n,$$typeof:s}=i;i.default;let o=(0,r.createProxy)(String.raw`D:\FEMBI NUR ILHAM\NUTECH\PROJECT\dashboard_executive_cms\app\(admin)\prasarana\operationalIndicatorMaintenance\page.tsx#default`)}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[3023,9400,385,1862,1063,961,462,124,7619,4187,9558,3627,9899],()=>t(23919));module.exports=r})();