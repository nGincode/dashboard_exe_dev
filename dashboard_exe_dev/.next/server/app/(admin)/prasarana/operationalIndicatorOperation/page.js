(()=>{var e={};e.id=7353,e.ids=[7353],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},64027:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>o.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>l,routeModule:()=>_,tree:()=>c}),a(6338),a(20461),a(24513),a(57198),a(12742),a(39614),a(26083),a(19644),a(96560);var r=a(23191),i=a(88716),n=a(37922),o=a.n(n),s=a(95231),d={};for(let e in s)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>s[e]);a.d(t,d);let c=["",{children:["(admin)",{children:["prasarana",{children:["operationalIndicatorOperation",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,6338)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\prasarana\\operationalIndicatorOperation\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,20461)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\layout.tsx"],error:[()=>Promise.resolve().then(a.bind(a,24513)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\error.tsx"],loading:[()=>Promise.resolve().then(a.bind(a,57198)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\loading.tsx"],"not-found":[()=>Promise.resolve().then(a.bind(a,12742)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\not-found.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,39614)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\layout.tsx"],error:[()=>Promise.resolve().then(a.bind(a,26083)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\error.tsx"],loading:[()=>Promise.resolve().then(a.bind(a,19644)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(a.bind(a,96560)),"D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\not-found.tsx"]}],l=["D:\\FEMBI NUR ILHAM\\NUTECH\\PROJECT\\dashboard_executive_cms\\app\\(admin)\\prasarana\\operationalIndicatorOperation\\page.tsx"],p="/(admin)/prasarana/operationalIndicatorOperation/page",u={require:a,loadChunk:()=>Promise.resolve()},_=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(admin)/prasarana/operationalIndicatorOperation/page",pathname:"/prasarana/operationalIndicatorOperation",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},12391:(e,t,a)=>{Promise.resolve().then(a.bind(a,37943))},37943:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>A});var r=a(10326),i=a(17577),n=a(95425),o=a(20341),s=a(44624),d=a(35047),c=a(74525),l=a(34626),p=a(59270),u=a(6400),_=a(55113),m=a(60816),x=a(46752),h=a(92379),g=a(37619),f=a(50784),y=a(91862),v=a(87337),b=a(75698),E=a(88295),P=a.n(E),I=a(52279);let N=(e,t)=>{let a=String(t).padStart(2,"0");return Array.from({length:P()(`${e}-${a}`).daysInMonth()},(t,r)=>P()(`${e}-${a}-${r+1}`).format("YYYY-MM-DD"))},j=({data:e,isEditable:t,handleInputChange:a,periodeDate:n,getDataMaster:o})=>{let[d,f]=(0,i.useState)(!1),[y,v]=(0,i.useState)(!1),{Panel:b}=c.default,E=parseInt(n.period_year,10),j=parseInt(n.period_month,10),A=P()().format("YYYY-MM-DD"),M=l.Z.useApp(),C=(0,i.useMemo)(()=>N(E,j),[E,j]),S=[{title:"Tanggal Operasi",dataIndex:"d_opr",key:"d_opr"},{title:"Jangka Waktu Operasi Pelayanan KA (menit)",dataIndex:"i_operation_time",key:"i_operation_time",render:(e,i)=>t&&i.d_opr<=A&&4!==i.i_status_active?r.jsx(p.default,{defaultValue:"-"===e?"":e,type:"number",min:0,onChange:e=>a(i.n_indicator,i.c_indicator,i.d_opr,"i_operation_time",e.target.value,i.i_id)}):r.jsx(r.Fragment,{children:i.d_opr<=A?e:r.jsx(r.Fragment,{children:t?r.jsx(p.default,{disabled:!0}):e})})},{title:"Jangka Waktu Operasi yang Terganggu (menit)",dataIndex:"i_operation_time_disturb",key:"i_operation_time_disturb",render:(e,i)=>t&&i.d_opr<=A&&4!==i.i_status_active?r.jsx(p.default,{defaultValue:"-"===e?"":e,type:"number",min:0,onChange:e=>a(i.n_indicator,i.c_indicator,i.d_opr,"i_operation_time_disturb",e.target.value,i.i_id)}):r.jsx(r.Fragment,{children:i.d_opr<=A?e:r.jsx(r.Fragment,{children:t?r.jsx(p.default,{disabled:!0}):e})})},{title:"Presentase",dataIndex:"i_percentage",key:"i_percentage",render:e=>r.jsx(r.Fragment,{children:"-"===e?"-":`${e} %`})},{title:"Status",dataIndex:"i_status_active",key:"i_status_active",align:"center",render:e=>T(e)},{title:"Aksi",dataIndex:"i_status_active",key:"action",align:"center",render:(e,a)=>1===a.i_status_active?r.jsx(u.Z,{placement:"rightTop",title:"Approve",arrow:!0,children:r.jsx(_.Z,{title:"Anda yakin untuk disetujui?",onConfirm:O(a),onCancel:()=>null,okText:"Yes",cancelText:"No",children:r.jsx(m.ZP,{size:"small",type:"link",shape:"circle",icon:r.jsx("i",{className:"fa-solid fa-circle-check fa-2x"}),disabled:t})})}):4===a.i_status_active?r.jsx(u.Z,{placement:"rightTop",title:"Unapprove",arrow:!0,children:r.jsx(_.Z,{title:"Anda yakin untuk tidak disetujui?",onConfirm:k(a),onCancel:()=>null,okText:"Yes",cancelText:"No",children:r.jsx(m.ZP,{size:"small",type:"link",shape:"circle",icon:r.jsx("i",{className:"fa-solid fa-circle-xmark fa-2x text-[#FE4545]"}),disabled:t})})}):null}],O=e=>async()=>{try{v(!0);let t={c_dashboard_type:"PENGOPERASIAN",c_param:"OPERASIONAL",data:[{i_id:e.i_id,d_opr:e.d_opr}]},a=await (0,I.Z)().put("/prasarana/approval",t);(0,s.Z)({res:a,app:M})?(f(!1),o(`${E}_${E}`,`${j}_${j}`),x.ZP.success("Successful Save")):f(!1)}catch(e){console.log("error",e)}finally{v(!1)}},k=e=>async()=>{try{f(!0);let t={c_dashboard_type:"PENGOPERASIAN",c_param:"OPERASIONAL",data:[{i_id:e.i_id,d_opr:e.d_opr}]},a=await (0,I.Z)().put("/prasarana/unapproval",t);(0,s.Z)({res:a,app:M})?(f(!1),o(`${E}_${E}`,`${j}_${j}`),x.ZP.success("Successful Save")):f(!1)}catch(e){console.log("error",e)}finally{f(!1)}},T=e=>{if("-"===e)return"-";let t="default",a="-";switch(e){case 1:t="blue",a="Ready to Approve";break;case 4:t="green",a="Approve";break;default:t="default",a="-"}return r.jsx(h.Z,{color:t,children:a})},R=e?.map(e=>e.c_indicator);return r.jsx(c.default,{defaultActiveKey:R,children:e.map(e=>{let t=C.map(t=>{let a=e.record.find(e=>e.d_opr===t);return{...a,n_indicator:e.n_indicator,c_indicator:e.c_indicator,i_id:a?.i_id??"",d_opr:t,i_operation_time:a?.i_operation_time??"-",i_operation_time_disturb:a?.i_operation_time_disturb??"-",i_percentage:a?.i_percentage??"-",i_status_active:a?.i_status_active??"-"}});return r.jsx(b,{header:e.n_indicator,children:r.jsx(g.Z,{columns:S,dataSource:t,rowKey:"d_opr",pagination:!1,bordered:!0,scroll:{x:"max-content"}})},e.c_indicator)})})},A=()=>{let e=(0,i.useContext)(o.Z),t=(0,d.usePathname)(),[a,c]=(0,i.useState)(null),[p,u]=(0,i.useState)(!1),[_,x]=(0,i.useState)([]),[h,g]=(0,i.useState)({period_year:"",period_month:""}),[E,N]=(0,i.useState)(!1),[A,M]=(0,i.useState)(!1),[C,S]=(0,i.useState)(!1),[O,k]=(0,i.useState)([]),[T,R]=(0,i.useState)(null),[Z,U]=(0,i.useState)(!1),q=l.Z.useApp(),{message:H,notification:$,modal:w}=q,D=async(e,t)=>{try{S(!0);let a=await (0,I.Z)().get(`/prasarana/master/target?period_year=${e}&period_month=${t}&c_dashboard_type=PENGOPERASIAN`);if((0,s.Z)({res:a,app:q})){let r=a.data[0].data.find(e=>"Operasional"===e.n_param);if(r){let a={...r,record:r.record.map(e=>{let{i_target:t,i_order:a,i_status_active:r,...i}=e;return i})};F(e,t,a)}else console.log("data not found"),k([])}else S(!1)}catch(e){console.log("error get data master",e),k([])}finally{S(!1)}},F=async(e,t,a)=>{try{S(!0);let r=await (0,I.Z)().get(`/prasarana/operation/operational?period_year=${e}&period_month=${t}`,!0),i=new Map(r.data.data.map(e=>[e.c_indicator,e])),n=a.record.map(e=>{let t=i.get(e.c_indicator);return t?{...e,record:t.record}:{...e,record:[]}});k(n)}catch(e){R(e),console.log("error get data operasional",e)}finally{S(!1)}},Y=async()=>{if(0===_.length){console.log("Tidak ada perubahan yang disimpan");return}let e=_.reduce((e,t)=>{let{n_indicator:a,c_indicator:r,i_id:i,d_opr:n,i_operation_time:o,i_operation_time_disturb:s}=t,d=e.find(e=>e.n_indicator===a);d||(d={n_indicator:a,c_indicator:r,record:[]},e.push(d));let c=d.record.findIndex(e=>e.i_id===i&&e.d_opr===n),l={i_id:i,d_opr:n,i_operation_time:void 0!==o?Number(o):0,i_operation_time_disturb:void 0!==s?Number(s):0};return -1!==c?d.record[c]={...d.record[c],...l}:d.record.push(l),e},[]),t={period_year:parseInt(h.period_year,10),period_month:parseInt(h.period_month,10),data:e};try{U(!0);let e=await (0,I.Z)().post("/prasarana/operation/operational",t);(0,s.Z)({res:e,app:q})?(U(!1),x([]),H.success("Successful Save")):(x([]),U(!1)),D(h.period_year,h.period_month),u(!1)}catch(e){console.log("error save data operasional",e)}finally{U(!1)}},L=async()=>{try{M(!0);let e={c_dashboard_type:"PENGOPERASIAN",c_param:"OPERASIONAL",data:[]};O.forEach(t=>{t.record.filter(e=>1===e.i_status_active).forEach(t=>{e.data.push({i_id:t.i_id,d_opr:t.d_opr})})}),console.log("payload",e);let t=await (0,I.Z)().put("/prasarana/approval",e);(0,s.Z)({res:t,app:q})?(M(!1),D(h.period_year,h.period_month),H.success("Successful Save")):M(!1)}catch(e){console.log("error",e)}finally{M(!1)}};return r.jsx(n.Z,{pathname:t,globalState:e,children:(0,r.jsxs)(f.Z,{className:"rounded-2xl border border-zinc-200 bg-white text-zinc-950 dark:border-zinc-800 dark:bg-zinc-950 dark:text-zinc-50 border-none w-full shadow-lg min-h-[600px]",children:[r.jsx("div",{className:"text-lg font-bold mb-3",children:"Periode"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx(y.default,{className:"mb-5",onChange:(e,t)=>{let a="",r="";c(e),e?(g({period_year:a=`${P()(e).format("YYYY")}_${P()(e).format("YYYY")}`,period_month:r=`${P()(e).format("MM")}_${P()(e).format("MM")}`}),D(a,r)):console.log("Date is null")},picker:"month"}),O.length?(0,r.jsxs)("div",{className:"flex gap-4",children:[r.jsx(m.ZP,{onClick:()=>{u(!p),p&&Y()},type:"primary",className:"mb-5",loading:Z,children:p?"Save":"Edit"}),(e=>{for(let t of e)for(let e of t?.record)if(e?.i_status_active!==4)return!1;return!0})(O)?null:r.jsx(m.ZP,{type:"primary",onClick:L,loading:A,disabled:p,children:"Approve"})]}):null]}),C?r.jsx(v.Z,{active:!0}):r.jsx(r.Fragment,{children:O.length?T?(0,r.jsxs)("div",{children:["Error: ",T.message]}):r.jsx(j,{data:O,isEditable:p,handleInputChange:(e,t,a,r,i,n)=>{k(t=>t.map(t=>t.n_indicator===e?{...t,record:t.record.map(e=>e.d_opr===a?{...e,[r]:i}:e)}:t)),x(o=>{let s=o.findIndex(r=>r.n_indicator===e&&r.c_indicator===t&&r.d_opr===a&&r.i_id===n);if(-1!==s){let e=[...o];return e[s]={...e[s],[r]:i},e}{let s=O.find(t=>t.n_indicator===e)?.record.find(e=>e.d_opr===a);return[...o,{i_id:n,d_opr:a,n_indicator:e,c_indicator:t,i_operation_time:s?.i_operation_time||"",i_operation_time_disturb:s?.i_operation_time_disturb||"",i_percentage:s?.i_percentage||"",i_status_active:s?.i_status_active||"",[r]:i}]}})},periodeDate:h,getDataMaster:D}):r.jsx(b.Z,{imageStyle:{height:200}})})]})})}},6338:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>o,__esModule:()=>n,default:()=>s});var r=a(68570);let i=(0,r.createProxy)(String.raw`D:\FEMBI NUR ILHAM\NUTECH\PROJECT\dashboard_executive_cms\app\(admin)\prasarana\operationalIndicatorOperation\page.tsx`),{__esModule:n,$$typeof:o}=i;i.default;let s=(0,r.createProxy)(String.raw`D:\FEMBI NUR ILHAM\NUTECH\PROJECT\dashboard_executive_cms\app\(admin)\prasarana\operationalIndicatorOperation\page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[3023,9400,385,1862,1063,961,462,124,7619,4187,9558,3627,9899],()=>a(64027));module.exports=r})();