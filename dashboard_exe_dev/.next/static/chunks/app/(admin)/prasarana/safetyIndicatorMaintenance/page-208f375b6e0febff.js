(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2436],{28262:function(e,a,t){Promise.resolve().then(t.bind(t,95310))},95310:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return Y}});var n=t(57437),r=t(2265),o=t(68348),i=t(73454),l=t(3650),c=t(25325),s=t(26487),d=t(62476),u=t(88625),p=t(46682),_=t(18357),m=t(77733),f=t(95381),g=t(95053),h=t(62575),y=t(38378),v=t(62737),b=t.n(v),x=t(30939),C=t(42005),j=t(65188),k=t(71275),S=t(16463),Z=t(38797);function Y(){let{message:e}=o.Z.useApp(),a=(0,r.useContext)(k.Z),t=(0,S.usePathname)(),v=o.Z.useApp(),[Y,E]=(0,r.useState)(null),[A,I]=(0,r.useState)([]),[N,O]=(0,r.useState)([]),[M,w]=(0,r.useState)([]),[P,T]=(0,r.useState)(!1),[D]=i.Z.useForm(),[B,F]=(0,r.useState)([]),[R,L]=(0,r.useState)(!1),[z,H]=(0,r.useState)(!1),[W,q]=(0,r.useState)(!1),[K,J]=(0,r.useState)([]),[U,V]=(0,r.useState)([]),X=Y?(e=>{let a=b()(e).startOf("month"),t=b()(e).endOf("month"),n=[],r=a;for(;r<=t;)n.push(r.format("YYYY-MM-DD")),r=r.add(1,"day");return n})(Y):[],Q=0==B.length?[]:X.map((e,a)=>{let t=A.find(a=>b()(a.d_opr).format("YYYY-MM-DD")==e),n=B.map((e,a)=>{var n;return{i_id:e.i_id||"",c_indicator:e.c_indicator||"",n_indicator:e.n_indicator||"",i_value:(null==t?void 0:null===(n=t.indicator[a])||void 0===n?void 0:n.i_value)||"-"}});return{...t||{d_opr:e,indicator:n,reason:[{n_reason_1:!1,n_reason_2:!1}],i_status_active:0},key:a}}),$=X.map((e,a)=>{let t=N.find(a=>b()(a.d_opr).format("YYYY-MM-DD")==e),n=B.map((e,a)=>{var n;return{i_id:e.i_id||"",c_indicator:e.c_indicator||"",n_indicator:e.n_indicator||"",i_value:(null==t?void 0:null===(n=t.indicator[a])||void 0===n?void 0:n.i_value)||"-"}});return{...t||{d_opr:e,indicator:n,reason:[{n_reason_1:!1,n_reason_2:!1}],i_status_active:0},key:a}}),G=async()=>{L(!0);try{let a=[];Q.forEach((e,t)=>{let n=$.find(a=>a.d_opr===e.d_opr);n?JSON.stringify(e)!==JSON.stringify(n)&&a.push(e):a.push(e)});let t=a.map(e=>({d_opr:e.d_opr,indicator:e.indicator.map(e=>({i_id:e.i_id?e.i_id:"",c_indicator:e.c_indicator,n_indicator:e.n_indicator,i_value:"-"==e.i_value?0:parseInt(e.i_value)})).filter(e=>!isNaN(e.i_value)),n_reason_1:null!==e.reason[0].n_reason_1&&e.reason[0].n_reason_1,n_reason_2:null!==e.reason[0].n_reason_2&&e.reason[0].n_reason_2})).filter(e=>e.indicator.length>0),n=null==Y?void 0:Y.split("-"),r=0,o=0;n&&2===n.length&&(r=parseInt(n[0]),o=parseInt(n[1]));let i={period_month:o,period_year:r,data:t};console.log("body",i),console.log("dataWithDefaultDates",Q);let l=await (0,C.Z)().post("/prasarana/maintenance/safety",i);(0,x.Z)({res:l,app:v})&&(el(),e.success("Successful Save")),L(!1),D.resetFields(),T(!1),L(!1)}catch(e){console.log("Validate Failed:",e)}},ee=async()=>{H(!0);let a=M.flatMap(e=>e.indicator.map(a=>({i_id:a.i_id,d_opr:e.d_opr}))),t=await (0,C.Z)().put("/prasarana/approval",{c_dashboard_type:"PERAWATAN",c_param:"KESELAMATAN",data:a||[]});(0,x.Z)({res:t,app:v}),(0,x.Z)({res:t,app:v})?(e.success("Successful Save"),H(!1),el()):H(!1)},ea=async()=>{q(!0);let a=U?U[0].d_opr:"",t=U[0].indicator.map(e=>({i_id:e.i_id,d_opr:a})),n=await (0,C.Z)().put("/prasarana/approval",{c_dashboard_type:"PERAWATAN",c_param:"KESELAMATAN",data:t});(0,x.Z)({res:n,app:v})?(q(!1),e.success("Successful Save"),el()):q(!1)},et=async()=>{q(!0);let a=K?K[0].d_opr:"",t=K[0].indicator.filter(e=>""!==e.i_id).map(e=>({i_id:e.i_id,d_opr:a})),n=await (0,C.Z)().put("/prasarana/unapproval",{c_dashboard_type:"PERAWATAN",c_param:"KESELAMATAN",data:t});(0,x.Z)({res:n,app:v})?(q(!1),e.success("Successful Save"),el()):q(!1)},en=(e,a)=>{let{name:t,checked:n}=e.target;I(Q.map(e=>e.d_opr===a.d_opr?{...e,reason:[{...e.reason[0],[t]:n}]}:e))},er=(e,a,t)=>{let{name:n,value:r}=e.target;I(Q.map(e=>e.d_opr===a.d_opr?{...e,indicator:e.indicator.map((e,a)=>a===t?{...e,i_value:r}:e)}:e))},eo=e=>{if("-"===e)return"-";let a="default",t="-";switch(e){case 1:a="blue",t="Ready to approve";break;case 4:a="green",t="Approve"}return"-"===t?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,n.jsx)("p",{children:t})}):(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,n.jsx)(l.Z,{color:P?"rgba(0, 0, 0, 0.25)":a,children:t})})},ei=[{title:"Tanggal",dataIndex:"d_opr",key:"d_opr"},...B.map((e,a)=>({title:e.n_indicator,dataIndex:["indicator",a,"i_value"],key:"i_value_".concat(e.c_indicator,"_").concat(a),render:(t,r)=>{let o=b()().format("YYYY-MM-DD"),l=b()(r.d_opr).format("YYYY-MM-DD");return P&&4!==r.i_status_active?(0,n.jsx)(i.Z.Item,{name:[r.d_opr,a,"i_value"],style:{margin:0},initialValue:null!==t?t:"",children:(0,n.jsx)(c.default,{name:e.c_indicator,onChange:e=>er(e,r,a),type:"number",disabled:l>o})}):(0,n.jsxs)(n.Fragment,{children:[""==r.indicator[a].i_id?"-":t,"-"!==t&&"PERSEN"===e.n_unit?"%":null]})}})),{title:"Penyebab",children:[{title:"Pemeriksaan yang tidak sesuai Standar Teknis dan SOP",dataIndex:["reason",0,"n_reason_1"],key:"n_reason_1",render:(e,a)=>{let t=b()().format("YYYY-MM-DD"),r=b()(a.d_opr).format("YYYY-MM-DD");return P&&4!==a.i_status_active?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,n.jsx)(i.Z.Item,{name:[a.d_opr,"n_reason_1"],style:{margin:0},children:(0,n.jsx)(s.Z,{name:"n_reason_1",defaultChecked:e,disabled:r>t,onChange:e=>en(e,a)})})}):e?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:"✓"}):(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:"-"})}},{title:"Pemeriksaan yang terlambat dilakukan",dataIndex:["reason",0,"n_reason_2"],key:"n_reason_2",render:(e,a)=>{let t=b()().format("YYYY-MM-DD"),r=b()(a.d_opr).format("YYYY-MM-DD");return P&&4!==a.i_status_active?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,n.jsx)(i.Z.Item,{name:[a.d_opr,"n_reason_2"],style:{margin:0},children:(0,n.jsx)(s.Z,{name:"n_reason_2",defaultChecked:e,disabled:r>t,onChange:e=>en(e,a)})})}):e?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:"✓"}):(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:"-"})}}]},{title:"Status",dataIndex:"i_status_active",key:"i_status_active",align:"center",render:e=>eo(e)},{title:"Action",dataIndex:"Action",key:"Action",render:(e,t)=>4===t.i_status_active?(0,n.jsx)(n.Fragment,{children:a.permission.includes("unapprove")&&(0,n.jsx)(d.Z,{className:"pl-2",title:"Sure to unaprove?",onConfirm:et,disabled:P,children:(0,n.jsx)("a",{onClick:()=>J([t]),style:{color:"red"},children:(0,n.jsx)(u.Z,{placement:"rightTop",title:"Unapprove",arrow:!0,children:(0,n.jsx)("i",{style:{color:P?"rgba(0, 0, 0, 0.25)":"red"},className:"fa-solid fa-circle-xmark fa-2x text-[#FE4545]"})})})})}):1===t.i_status_active?(0,n.jsx)(n.Fragment,{children:a.permission.includes("approve")&&(0,n.jsx)(d.Z,{className:"pl-2",title:"Sure to aprove?",onConfirm:ea,disabled:P,children:(0,n.jsxs)("a",{onClick:()=>V([t]),children:[" ",(0,n.jsx)(u.Z,{placement:"rightTop",title:"Approve",arrow:!0,children:(0,n.jsx)(p.ZP,{size:"small",type:"link",shape:"circle",icon:(0,n.jsx)("i",{style:{color:P?"rgba(0, 0, 0, 0.25)":"#1677ff"},className:"fa-solid fa-circle-check fa-2x"})})})]})})}):null}],el=async()=>{let e,a;L(!0);let t=null==Y?void 0:Y.split("-"),n=0,r=0;t&&2===t.length&&(n=parseInt(t[0]),r=parseInt(t[1]),e="".concat(n,"_").concat(n),a="".concat(r,"_").concat(r));try{let t=await (0,C.Z)().get("/prasarana/indicator?period_year=".concat(e,"&period_month=").concat(a,"&c_dashboard_type=PERAWATAN&c_param=KESELAMATAN"),!0),n=await (0,C.Z)().get("/prasarana/maintenance/safety?period_year=".concat(e,"&period_month=").concat(a),!0);if((0,x.Z)({res:n.data,app:v})&&(0,x.Z)({res:t.data,app:v})){var o,i;let e=(null==n?void 0:null===(o=n.data)||void 0===o?void 0:o.data)||[],a=(null==t?void 0:null===(i=t.data)||void 0===i?void 0:i.data)||[],r=e.map(e=>{let t=a.map(a=>{let t=e.indicator.find(e=>e.c_indicator===a.c_indicator);return t?{...t,n_indicator:a.n_indicator,n_unit:a.n_unit,c_indicator:a.c_indicator}:{n_indicator:a.n_indicator,n_unit:a.n_unit,c_indicator:a.c_indicator,i_id:"",i_value:""}}).filter(Boolean),n=t.length>0,r=e.reason.length>0&&(void 0!==e.reason[0].n_reason_1||void 0!==e.reason[0].n_reason_2);return n&&r?{...e,indicator:t}:null}).filter(Boolean),l=r.filter(e=>1===e.i_status_active).map(e=>({...e,indicator:e.indicator.filter(e=>""!==e.i_id)}));w(l),O(r),I(r),F(a)}else w([]),O([]),I([]),F([])}catch(e){console.error("Error fetching data:",e),w([]),O([]),I([]),F([])}finally{L(!1)}};return(0,r.useEffect)(()=>{null!==Y?(T(!1),el()):T(!1)},[Y]),(0,n.jsx)(j.Z,{pathname:t,globalState:a,children:(0,n.jsxs)(_.Z,{children:[(0,n.jsxs)(m.Z,{justify:"space-between",className:"pb-5",children:[(0,n.jsx)(f.Z,{span:12,children:(0,n.jsx)(g.default,{className:"w-full",onChange:e=>{null!==e?E(b()(e).format("YYYY-MM")):E(null)},picker:"month"})}),(0,n.jsxs)(f.Z,{children:[0!==B.length&&(0,n.jsxs)(n.Fragment,{children:[a.permission.includes("create")&&(0,n.jsx)(p.ZP,{disabled:null===Y,type:"primary",loading:z,onClick:P?G:()=>{T(!0)},children:P?"Save":z?"Menyimpan":"Edit"}),P||0==M.length?null:a.permission.includes("approve")&&(0,n.jsx)(p.ZP,{disabled:null==Y||0==M.length,onClick:ee,type:"primary",className:"ml-2",loading:z,children:z?"Menyimpan":"Approval"})]}),P&&(0,n.jsx)(p.ZP,{disabled:null==Y,type:"default",onClick:()=>{I(N),T(!1)},className:"ml-2",children:"Cancel"})]})]}),0===Q.length?(0,n.jsx)(h.Z,{imageStyle:{height:200}}):(0,n.jsx)(i.Z,{form:D,component:!1,children:(0,n.jsx)(y.Z,{loading:R,bordered:!0,dataSource:Q,columns:Z.x4.web.headerTable(ei),scroll:{x:"max-content"},pagination:!1})})]})})}},95381:function(e,a,t){"use strict";var n=t(90265);a.Z=n.Z},77733:function(e,a,t){"use strict";var n=t(43134);a.Z=n.Z},3650:function(e,a,t){"use strict";t.d(a,{Z:function(){return I}});var n=t(2265),r=t(56800),o=t.n(r),i=t(88474),l=t(25629),c=t(63575),s=t(76415),d=t(50511),u=t(38750),p=t(37540),_=t(70142),m=t(98170),f=t(35413),g=t(2330);let h=e=>{let{paddingXXS:a,lineWidth:t,tagPaddingHorizontal:n,componentCls:r,calc:o}=e,i=o(n).sub(t).equal(),l=o(a).sub(t).equal();return{[r]:Object.assign(Object.assign({},(0,m.Wf)(e)),{display:"inline-block",height:"auto",marginInlineEnd:e.marginXS,paddingInline:i,fontSize:e.tagFontSize,lineHeight:e.tagLineHeight,whiteSpace:"nowrap",background:e.defaultBg,border:"".concat((0,p.bf)(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorBorder),borderRadius:e.borderRadiusSM,opacity:1,transition:"all ".concat(e.motionDurationMid),textAlign:"start",position:"relative",["&".concat(r,"-rtl")]:{direction:"rtl"},"&, a, a:hover":{color:e.defaultColor},["".concat(r,"-close-icon")]:{marginInlineStart:l,fontSize:e.tagIconSize,color:e.colorTextDescription,cursor:"pointer",transition:"all ".concat(e.motionDurationMid),"&:hover":{color:e.colorTextHeading}},["&".concat(r,"-has-color")]:{borderColor:"transparent",["&, a, a:hover, ".concat(e.iconCls,"-close, ").concat(e.iconCls,"-close:hover")]:{color:e.colorTextLightSolid}},"&-checkable":{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",["&:not(".concat(r,"-checkable-checked):hover")]:{color:e.colorPrimary,backgroundColor:e.colorFillSecondary},"&:active, &-checked":{color:e.colorTextLightSolid},"&-checked":{backgroundColor:e.colorPrimary,"&:hover":{backgroundColor:e.colorPrimaryHover}},"&:active":{backgroundColor:e.colorPrimaryActive}},"&-hidden":{display:"none"},["> ".concat(e.iconCls," + span, > span + ").concat(e.iconCls)]:{marginInlineStart:i}}),["".concat(r,"-borderless")]:{borderColor:"transparent",background:e.tagBorderlessBg}}},y=e=>{let{lineWidth:a,fontSizeIcon:t,calc:n}=e,r=e.fontSizeSM;return(0,f.IX)(e,{tagFontSize:r,tagLineHeight:(0,p.bf)(n(e.lineHeightSM).mul(r).equal()),tagIconSize:n(t).sub(n(a).mul(2)).equal(),tagPaddingHorizontal:8,tagBorderlessBg:e.defaultBg})},v=e=>({defaultBg:new _.C(e.colorFillQuaternary).onBackground(e.colorBgContainer).toHexString(),defaultColor:e.colorText});var b=(0,g.I$)("Tag",e=>h(y(e)),v),x=function(e,a){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>a.indexOf(n)&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>a.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(t[n[r]]=e[n[r]]);return t};let C=n.forwardRef((e,a)=>{let{prefixCls:t,style:r,className:i,checked:l,onChange:c,onClick:s}=e,d=x(e,["prefixCls","style","className","checked","onChange","onClick"]),{getPrefixCls:p,tag:_}=n.useContext(u.E_),m=p("tag",t),[f,g,h]=b(m),y=o()(m,"".concat(m,"-checkable"),{["".concat(m,"-checkable-checked")]:l},null==_?void 0:_.className,i,g,h);return f(n.createElement("span",Object.assign({},d,{ref:a,style:Object.assign(Object.assign({},r),null==_?void 0:_.style),className:y,onClick:e=>{null==c||c(!l),null==s||s(e)}})))});var j=t(57758);let k=e=>(0,j.Z)(e,(a,t)=>{let{textColor:n,lightBorderColor:r,lightColor:o,darkColor:i}=t;return{["".concat(e.componentCls).concat(e.componentCls,"-").concat(a)]:{color:n,background:o,borderColor:r,"&-inverse":{color:e.colorTextLightSolid,background:i,borderColor:i},["&".concat(e.componentCls,"-borderless")]:{borderColor:"transparent"}}}});var S=(0,g.bk)(["Tag","preset"],e=>k(y(e)),v);let Z=(e,a,t)=>{let n="string"!=typeof t?t:t.charAt(0).toUpperCase()+t.slice(1);return{["".concat(e.componentCls).concat(e.componentCls,"-").concat(a)]:{color:e["color".concat(t)],background:e["color".concat(n,"Bg")],borderColor:e["color".concat(n,"Border")],["&".concat(e.componentCls,"-borderless")]:{borderColor:"transparent"}}}};var Y=(0,g.bk)(["Tag","status"],e=>{let a=y(e);return[Z(a,"success","Success"),Z(a,"processing","Info"),Z(a,"error","Error"),Z(a,"warning","Warning")]},v),E=function(e,a){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>a.indexOf(n)&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>a.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(t[n[r]]=e[n[r]]);return t};let A=n.forwardRef((e,a)=>{let{prefixCls:t,className:r,rootClassName:p,style:_,children:m,icon:f,color:g,onClose:h,bordered:y=!0,visible:v}=e,x=E(e,["prefixCls","className","rootClassName","style","children","icon","color","onClose","bordered","visible"]),{getPrefixCls:C,direction:j,tag:k}=n.useContext(u.E_),[Z,A]=n.useState(!0),I=(0,i.Z)(x,["closeIcon","closable"]);n.useEffect(()=>{void 0!==v&&A(v)},[v]);let N=(0,l.o2)(g),O=(0,l.yT)(g),M=N||O,w=Object.assign(Object.assign({backgroundColor:g&&!M?g:void 0},null==k?void 0:k.style),_),P=C("tag",t),[T,D,B]=b(P),F=o()(P,null==k?void 0:k.className,{["".concat(P,"-").concat(g)]:M,["".concat(P,"-has-color")]:g&&!M,["".concat(P,"-hidden")]:!Z,["".concat(P,"-rtl")]:"rtl"===j,["".concat(P,"-borderless")]:!y},r,p,D,B),R=e=>{e.stopPropagation(),null==h||h(e),e.defaultPrevented||A(!1)},[,L]=(0,c.Z)((0,c.w)(e),(0,c.w)(k),{closable:!1,closeIconRender:e=>{let a=n.createElement("span",{className:"".concat(P,"-close-icon"),onClick:R},e);return(0,s.wm)(e,a,e=>({onClick:a=>{var t;null===(t=null==e?void 0:e.onClick)||void 0===t||t.call(e,a),R(a)},className:o()(null==e?void 0:e.className,"".concat(P,"-close-icon"))}))}}),z="function"==typeof x.onClick||m&&"a"===m.type,H=f||null,W=H?n.createElement(n.Fragment,null,H,m&&n.createElement("span",null,m)):m,q=n.createElement("span",Object.assign({},I,{ref:a,className:F,style:w}),W,L,N&&n.createElement(S,{key:"preset",prefixCls:P}),O&&n.createElement(Y,{key:"status",prefixCls:P}));return T(z?n.createElement(d.Z,{component:"Tag"},q):q)});A.CheckableTag=C;var I=A}},function(e){e.O(0,[2505,8173,9141,2470,3919,8348,2100,4309,5053,5458,2034,9155,7824,428,8421,8028,4052,5325,6487,8378,4746,7149,3454,1319,7642,2971,7023,1744],function(){return e(e.s=28262)}),_N_E=e.O()}]);