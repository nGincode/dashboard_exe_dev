(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5343],{48676:function(e,t,a){Promise.resolve().then(a.bind(a,43008))},43008:function(e,t,a){"use strict";a.r(t);var r=a(57437),n=a(2265),i=a(65188),o=a(71275),l=a(30939),s=a(16463),c=a(27840),d=a(68348),u=a(25325),p=a(88625),_=a(62476),m=a(46682),f=a(93122),g=a(3650),h=a(38378),y=a(18357),v=a(95053),x=a(10549),b=a(62575),j=a(62737),k=a.n(j),Z=a(42005);let A=(e,t)=>{let a=String(t).padStart(2,"0");return Array.from({length:k()("".concat(e,"-").concat(a)).daysInMonth()},(t,r)=>k()("".concat(e,"-").concat(a,"-").concat(r+1)).format("YYYY-MM-DD"))},S=e=>{let{data:t,isEditable:a,handleInputChange:i,periodeDate:o,getDataMaster:s}=e,[y,v]=(0,n.useState)(!1),[x,b]=(0,n.useState)(!1),{Panel:j}=c.default,S=parseInt(o.period_year,10),C=parseInt(o.period_month,10),P=k()().format("YYYY-MM-DD"),E=d.Z.useApp(),w=(0,n.useMemo)(()=>A(S,C),[S,C]),N=[{title:"Tanggal Operasi",dataIndex:"d_opr",key:"d_opr"},{title:"Jangka Waktu Operasi Pelayanan KA (menit)",dataIndex:"i_operation_time",key:"i_operation_time",render:(e,t)=>a&&t.d_opr<=P&&4!==t.i_status_active?(0,r.jsx)(u.default,{type:"number",min:0,defaultValue:"-"===e?"":e,onChange:e=>i(t.n_indicator,t.c_indicator,t.d_opr,"i_operation_time",e.target.value,t.i_id)}):(0,r.jsx)(r.Fragment,{children:t.d_opr<=P?e:(0,r.jsx)(r.Fragment,{children:a?(0,r.jsx)(u.default,{disabled:!0}):e})})},{title:"Jangka Waktu Operasi yang Terganggu (menit)",dataIndex:"i_operation_time_disturb",key:"i_operation_time_disturb",render:(e,t)=>a&&t.d_opr<=P&&4!==t.i_status_active?(0,r.jsx)(u.default,{type:"number",min:0,defaultValue:"-"===e?"":e,onChange:e=>i(t.n_indicator,t.c_indicator,t.d_opr,"i_operation_time_disturb",e.target.value,t.i_id)}):(0,r.jsx)(r.Fragment,{children:t.d_opr<=P?e:(0,r.jsx)(r.Fragment,{children:a?(0,r.jsx)(u.default,{disabled:!0}):e})})},{title:"Presentase",dataIndex:"i_percentage",key:"i_percentage",render:e=>(0,r.jsx)(r.Fragment,{children:"-"===e?"-":"".concat(e," %")})},{title:"Status",dataIndex:"i_status_active",key:"i_status_active",align:"center",render:e=>Y(e)},{title:"Aksi",dataIndex:"i_status_active",key:"action",align:"center",render:(e,t)=>1===t.i_status_active?(0,r.jsx)(p.Z,{placement:"rightTop",title:"Approve",arrow:!0,children:(0,r.jsx)(_.Z,{title:"Anda yakin untuk disetujui?",onConfirm:O(t),onCancel:()=>null,okText:"Yes",cancelText:"No",children:(0,r.jsx)(m.ZP,{size:"small",type:"link",shape:"circle",icon:(0,r.jsx)("i",{className:"fa-solid fa-circle-check fa-2x"}),disabled:a})})}):4===t.i_status_active?(0,r.jsx)(p.Z,{placement:"rightTop",title:"Unapprove",arrow:!0,children:(0,r.jsx)(_.Z,{title:"Anda yakin untuk tidak disetujui?",onConfirm:I(t),onCancel:()=>null,okText:"Yes",cancelText:"No",children:(0,r.jsx)(m.ZP,{size:"small",type:"link",shape:"circle",icon:(0,r.jsx)("i",{className:"fa-solid fa-circle-xmark fa-2x text-[#FE4545]"}),disabled:a})})}):null}],O=e=>async()=>{try{b(!0);let t={c_dashboard_type:"PERAWATAN",c_param:"OPERASIONAL",data:[{i_id:e.i_id,d_opr:e.d_opr}]},a=await (0,Z.Z)().put("/prasarana/approval",t);(0,l.Z)({res:a,app:E})?(v(!1),s("".concat(S,"_").concat(S),"".concat(C,"_").concat(C)),f.ZP.success("Successful Save")):v(!1)}catch(e){console.log("error",e)}finally{b(!1)}},I=e=>async()=>{try{v(!0);let t={c_dashboard_type:"PERAWATAN",c_param:"OPERASIONAL",data:[{i_id:e.i_id,d_opr:e.d_opr}]},a=await (0,Z.Z)().put("/prasarana/unapproval",t);(0,l.Z)({res:a,app:E})?(v(!1),s("".concat(S,"_").concat(S),"".concat(C,"_").concat(C)),f.ZP.success("Successful Save")):v(!1)}catch(e){console.log("error",e)}finally{v(!1)}},Y=e=>{if("-"===e)return"-";let t="default",a="-";switch(e){case 1:t="blue",a="Ready to Approve";break;case 4:t="green",a="Approve";break;default:t="default",a="-"}return(0,r.jsx)(g.Z,{color:t,children:a})},T=null==t?void 0:t.map(e=>e.c_indicator);return(0,r.jsx)(c.default,{defaultActiveKey:T,children:t.map(e=>{let t=w.map(t=>{var a,r,n,i,o;let l=e.record.find(e=>e.d_opr===t);return{...l,n_indicator:e.n_indicator,c_indicator:e.c_indicator,i_id:null!==(a=null==l?void 0:l.i_id)&&void 0!==a?a:"",d_opr:t,i_operation_time:null!==(r=null==l?void 0:l.i_operation_time)&&void 0!==r?r:"-",i_operation_time_disturb:null!==(n=null==l?void 0:l.i_operation_time_disturb)&&void 0!==n?n:"-",i_percentage:null!==(i=null==l?void 0:l.i_percentage)&&void 0!==i?i:"-",i_status_active:null!==(o=null==l?void 0:l.i_status_active)&&void 0!==o?o:"-"}});return(0,r.jsx)(j,{header:e.n_indicator,children:(0,r.jsx)(h.Z,{columns:N,dataSource:t,rowKey:"d_opr",pagination:!1,bordered:!0,scroll:{x:"max-content"}})},e.c_indicator)})})};t.default=()=>{let e=(0,n.useContext)(o.Z),t=(0,s.usePathname)(),[a,c]=(0,n.useState)(null),[u,p]=(0,n.useState)(!1),[_,f]=(0,n.useState)([]),[g,h]=(0,n.useState)({period_year:"",period_month:""}),[j,A]=(0,n.useState)(!1),[C,P]=(0,n.useState)(!1),[E,w]=(0,n.useState)(!1),[N,O]=(0,n.useState)([]),[I,Y]=(0,n.useState)(null),[T,F]=(0,n.useState)(!1),M=d.Z.useApp(),{message:R,notification:D,modal:z}=M,W=async(e,t)=>{try{w(!0);let a=await (0,Z.Z)().get("/prasarana/master/target?period_year=".concat(e,"&period_month=").concat(t,"&c_dashboard_type=PERAWATAN"));if((0,l.Z)({res:a,app:M})){let r=a.data[0].data.find(e=>"Operasional"===e.n_param);if(r){let a={...r,record:r.record.map(e=>{let{i_target:t,i_order:a,i_status_active:r,...n}=e;return n})};J(e,t,a)}else console.log("data not found"),O([])}else w(!1)}catch(e){console.log("error get data master",e),O([])}finally{w(!1)}},J=async(e,t,a)=>{try{w(!0);let r=await (0,Z.Z)().get("/prasarana/maintenance/operational?period_year=".concat(e,"&period_month=").concat(t),!0),n=new Map(r.data.data.map(e=>[e.c_indicator,e])),i=a.record.map(e=>{let t=n.get(e.c_indicator);return t?{...e,record:t.record}:{...e,record:[]}});O(i)}catch(e){Y(e),console.log("error get data operasional",e)}finally{w(!1)}},K=async()=>{if(0===_.length){console.log("Tidak ada perubahan yang disimpan");return}let e=_.reduce((e,t)=>{let{n_indicator:a,c_indicator:r,i_id:n,d_opr:i,i_operation_time:o,i_operation_time_disturb:l}=t,s=e.find(e=>e.n_indicator===a);s||(s={n_indicator:a,c_indicator:r,record:[]},e.push(s));let c=s.record.findIndex(e=>e.i_id===n&&e.d_opr===i),d={i_id:n,d_opr:i,i_operation_time:void 0!==o?Number(o):0,i_operation_time_disturb:void 0!==l?Number(l):0};return -1!==c?s.record[c]={...s.record[c],...d}:s.record.push(d),e},[]),t={period_year:parseInt(g.period_year,10),period_month:parseInt(g.period_month,10),data:e};try{F(!0);let e=await (0,Z.Z)().post("/prasarana/maintenance/operational",t);(0,l.Z)({res:e,app:M})?(F(!1),f([]),R.success("Successful Save")):(f([]),F(!1)),W(g.period_year,g.period_month),p(!1)}catch(e){console.log("error save data operasional",e)}finally{F(!1)}},L=async()=>{try{P(!0);let e={c_dashboard_type:"PERAWATAN",c_param:"OPERASIONAL",data:[]};N.forEach(t=>{t.record.filter(e=>1===e.i_status_active).forEach(t=>{e.data.push({i_id:t.i_id,d_opr:t.d_opr})})});let t=await (0,Z.Z)().put("/prasarana/approval",e);(0,l.Z)({res:t,app:M})?(P(!1),W(g.period_year,g.period_month),R.success("Successful Save")):P(!1)}catch(e){console.log("error",e)}finally{P(!1)}};return(0,r.jsx)(i.Z,{pathname:t,globalState:e,children:(0,r.jsxs)(y.Z,{className:"rounded-2xl border border-zinc-200 bg-white text-zinc-950 dark:border-zinc-800 dark:bg-zinc-950 dark:text-zinc-50 border-none w-full shadow-lg min-h-[600px]",children:[(0,r.jsx)("div",{className:"text-lg font-bold mb-3",children:"Periode"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(v.default,{className:"mb-5",onChange:(e,t)=>{let a="",r="";c(e),e?(h({period_year:a="".concat(k()(e).format("YYYY"),"_").concat(k()(e).format("YYYY")),period_month:r="".concat(k()(e).format("MM"),"_").concat(k()(e).format("MM"))}),W(a,r)):console.log("Date is null")},picker:"month"}),N.length?(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)(m.ZP,{onClick:()=>{p(!u),u&&K()},type:"primary",className:"mb-5",loading:T,children:u?"Save":"Edit"}),(e=>{for(let t of e)for(let e of null==t?void 0:t.record)if((null==e?void 0:e.i_status_active)!==4)return!1;return!0})(N)?null:(0,r.jsx)(m.ZP,{type:"primary",onClick:L,loading:C,disabled:u,children:"Approve"})]}):null]}),E?(0,r.jsx)(x.Z,{active:!0}):(0,r.jsx)(r.Fragment,{children:N.length?I?(0,r.jsxs)("div",{children:["Error: ",I.message]}):(0,r.jsx)(S,{data:N,isEditable:u,handleInputChange:(e,t,a,r,n,i)=>{O(t=>t.map(t=>t.n_indicator===e?{...t,record:t.record.map(e=>e.d_opr===a?{...e,[r]:n}:e)}:t)),f(o=>{let l=o.findIndex(r=>r.n_indicator===e&&r.c_indicator===t&&r.d_opr===a&&r.i_id===i);if(-1!==l){let e=[...o];return e[l]={...e[l],[r]:n},e}{var s;let l=null===(s=N.find(t=>t.n_indicator===e))||void 0===s?void 0:s.record.find(e=>e.d_opr===a);return[...o,{i_id:i,d_opr:a,n_indicator:e,c_indicator:t,i_operation_time:(null==l?void 0:l.i_operation_time)||"",i_operation_time_disturb:(null==l?void 0:l.i_operation_time_disturb)||"",i_percentage:(null==l?void 0:l.i_percentage)||"",i_status_active:(null==l?void 0:l.i_status_active)||"",[r]:n}]}})},periodeDate:g,getDataMaster:W}):(0,r.jsx)(b.Z,{imageStyle:{height:200}})})]})})}},93122:function(e,t,a){"use strict";var r=a(57111),n=a(2265),i=a(9603),o=a(84345),l=a(38750),s=a(62586),c=a(96447),d=a(83056),u=a(62267);let p=null,_=e=>e(),m=[],f={};function g(){let{getContainer:e,duration:t,rtl:a,maxCount:r,top:n}=f,i=(null==e?void 0:e())||document.body;return{getContainer:()=>i,duration:t,rtl:a,maxCount:r,top:n}}let h=n.forwardRef((e,t)=>{let{messageConfig:a,sync:r}=e,{getPrefixCls:i}=(0,n.useContext)(l.E_),s=f.prefixCls||i("message"),c=(0,n.useContext)(o.J),[u,p]=(0,d.K)(Object.assign(Object.assign(Object.assign({},a),{prefixCls:s}),c.message));return n.useImperativeHandle(t,()=>{let e=Object.assign({},u);return Object.keys(e).forEach(t=>{e[t]=function(){return r(),u[t].apply(u,arguments)}}),{instance:e,sync:r}}),p}),y=n.forwardRef((e,t)=>{let[a,r]=n.useState(g),i=()=>{r(g)};n.useEffect(i,[]);let o=(0,s.w6)(),l=o.getRootPrefixCls(),c=o.getIconPrefixCls(),d=o.getTheme(),u=n.createElement(h,{ref:t,sync:i,messageConfig:a});return n.createElement(s.ZP,{prefixCls:l,iconPrefixCls:c,theme:d},o.holderRender?o.holderRender(u):u)});function v(){if(!p){let e=document.createDocumentFragment(),t={fragment:e};p=t,_(()=>{(0,i.s)(n.createElement(y,{ref:e=>{let{instance:a,sync:r}=e||{};Promise.resolve().then(()=>{!t.instance&&a&&(t.instance=a,t.sync=r,v())})}}),e)});return}p.instance&&(m.forEach(e=>{let{type:t,skipped:a}=e;if(!a)switch(t){case"open":_(()=>{let t=p.instance.open(Object.assign(Object.assign({},f),e.config));null==t||t.then(e.resolve),e.setCloseFn(t)});break;case"destroy":_(()=>{null==p||p.instance.destroy(e.key)});break;default:_(()=>{var a;let n=(a=p.instance)[t].apply(a,(0,r.Z)(e.args));null==n||n.then(e.resolve),e.setCloseFn(n)})}}),m=[])}let x={open:function(e){let t=(0,u.J)(t=>{let a;let r={type:"open",config:e,resolve:t,setCloseFn:e=>{a=e}};return m.push(r),()=>{a?_(()=>{a()}):r.skipped=!0}});return v(),t},destroy:e=>{m.push({type:"destroy",key:e}),v()},config:function(e){f=Object.assign(Object.assign({},f),e),_(()=>{var e;null===(e=null==p?void 0:p.sync)||void 0===e||e.call(p)})},useMessage:d.Z,_InternalPanelDoNotUseOrYouWillBeFired:c.ZP};["success","info","warning","error","loading"].forEach(e=>{x[e]=function(){for(var t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];return function(e,t){(0,s.w6)();let a=(0,u.J)(a=>{let r;let n={type:e,args:t,resolve:a,setCloseFn:e=>{r=e}};return m.push(n),()=>{r?_(()=>{r()}):n.skipped=!0}});return v(),a}(e,a)}}),t.ZP=x}},function(e){e.O(0,[8173,9141,2470,3919,8348,2100,4309,5053,5458,2034,428,8421,8028,4052,5325,6487,8378,7149,1319,7805,4527,2971,7023,1744],function(){return e(e.s=48676)}),_N_E=e.O()}]);