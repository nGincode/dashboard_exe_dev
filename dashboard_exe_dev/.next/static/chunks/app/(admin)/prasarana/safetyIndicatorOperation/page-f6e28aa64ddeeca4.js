(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3880],{50678:function(e,a,n){Promise.resolve().then(n.bind(n,16974))},16974:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return Y}});var t=n(57437),r=n(2265),o=n(68348),i=n(73454),l=n(3650),c=n(25325),s=n(26487),d=n(62476),u=n(88625),p=n(46682),_=n(18357),m=n(77733),f=n(95381),g=n(95053),y=n(62575),h=n(38378),v=n(62737),b=n.n(v),x=n(30939),C=n(42005),j=n(65188),k=n(71275),S=n(16463),Z=n(38797);function Y(){let{message:e}=o.Z.useApp(),a=(0,r.useContext)(k.Z),n=(0,S.usePathname)(),v=o.Z.useApp(),[Y,I]=(0,r.useState)(null),[E,N]=(0,r.useState)([]),[O,M]=(0,r.useState)([]),[P,A]=(0,r.useState)([]),[w,D]=(0,r.useState)(!1),[T]=i.Z.useForm(),[B,F]=(0,r.useState)([]),[R,L]=(0,r.useState)(!1),[z,H]=(0,r.useState)(!1),[q,G]=(0,r.useState)(!1),[K,W]=(0,r.useState)([]),[J,U]=(0,r.useState)([]),V=Y?(e=>{let a=b()(e).startOf("month"),n=b()(e).endOf("month"),t=[],r=a;for(;r<=n;)t.push(r.format("YYYY-MM-DD")),r=r.add(1,"day");return t})(Y):[],X=0==B.length?[]:V.map((e,a)=>{let n=E.find(a=>b()(a.d_opr).format("YYYY-MM-DD")==e),t=B.map((e,a)=>{var t;return{i_id:e.i_id||"",c_indicator:e.c_indicator||"",n_indicator:e.n_indicator||"",i_value:(null==n?void 0:null===(t=n.indicator[a])||void 0===t?void 0:t.i_value)||"-"}});return{...n||{d_opr:e,indicator:t,reason:[{n_reason_1:!1,n_reason_2:!1}],i_status_active:0},key:a}}),Q=V.map((e,a)=>{let n=O.find(a=>b()(a.d_opr).format("YYYY-MM-DD")==e),t=B.map((e,a)=>{var t;return{i_id:e.i_id||"",c_indicator:e.c_indicator||"",n_indicator:e.n_indicator||"",i_value:(null==n?void 0:null===(t=n.indicator[a])||void 0===t?void 0:t.i_value)||"-"}});return{...n||{d_opr:e,indicator:t,reason:[{n_reason_1:!1,n_reason_2:!1}],i_status_active:0},key:a}}),$=async()=>{L(!0);try{let a=[];X.forEach((e,n)=>{let t=Q.find(a=>a.d_opr===e.d_opr);t?JSON.stringify(e)!==JSON.stringify(t)&&a.push(e):a.push(e)});let n=a.map(e=>({d_opr:e.d_opr,indicator:e.indicator.map(e=>({i_id:e.i_id,c_indicator:e.c_indicator,n_indicator:e.n_indicator,i_value:"-"==e.i_value?0:e.i_value})).filter(e=>!isNaN(e.i_value)),n_reason_1:null!==e.reason[0].n_reason_1&&e.reason[0].n_reason_1,n_reason_2:null!==e.reason[0].n_reason_2&&e.reason[0].n_reason_2,n_reason_3:null!==e.reason[0].n_reason_3&&void 0!==e.reason[0].n_reason_3&&e.reason[0].n_reason_3})).filter(e=>e.indicator.length>0),t=null==Y?void 0:Y.split("-"),r=0,o=0;t&&2===t.length&&(r=parseInt(t[0]),o=parseInt(t[1]));let i={period_month:o,period_year:r,data:n};console.log("body",i);let l=await (0,C.Z)().post("/prasarana/operation/safety",i);el(),(0,x.Z)({res:l,app:v})&&e.success("Successful Save"),L(!1),L(!1),D(!1)}catch(e){console.log("Validate Failed:",e)}},ee=async()=>{H(!0);let a=P.flatMap(e=>e.indicator.map(a=>({i_id:a.i_id,d_opr:e.d_opr}))),n=await (0,C.Z)().put("/prasarana/approval",{c_dashboard_type:"PENGOPERASIAN",c_param:"KESELAMATAN",data:a||[]});(0,x.Z)({res:n,app:v}),(0,x.Z)({res:n,app:v})?(H(!1),e.success("Successful Save"),el()):H(!1)},ea=async()=>{G(!0);let a=K?K[0].d_opr:"",n=K[0].indicator.filter(e=>""!==e.i_id).map(e=>({i_id:e.i_id,d_opr:a})),t=await (0,C.Z)().put("/prasarana/unapproval",{c_dashboard_type:"PENGOPERASIAN",c_param:"KESELAMATAN",data:n});(0,x.Z)({res:t,app:v}),(0,x.Z)({res:t,app:v})?(G(!1),e.success("Successful Save"),el()):G(!1)},en=async()=>{G(!0);let a=J?J[0].d_opr:"",n=J[0].indicator.map(e=>({i_id:e.i_id,d_opr:a})),t=await (0,C.Z)().put("/prasarana/approval",{c_dashboard_type:"PENGOPERASIAN",c_param:"KESELAMATAN",data:n});(0,x.Z)({res:t,app:v}),(0,x.Z)({res:t,app:v})?(e.success("Successful Save"),G(!1),el()):G(!1)},et=(e,a)=>{let{name:n,checked:t}=e.target;N(X.map(e=>e.d_opr===a.d_opr?{...e,reason:[{...e.reason[0],[n]:t}]}:e))},er=(e,a,n)=>{let{name:t,value:r}=e.target;N(X.map(e=>e.d_opr===a.d_opr?{...e,indicator:e.indicator.map((e,a)=>a===n?{...e,i_value:r}:e)}:e))},eo=e=>{if("-"===e)return"-";let a="default",n="-";switch(e){case 1:a="blue",n="Ready to approve";break;case 4:a="green",n="Approve"}return"-"===n?(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,t.jsx)("p",{children:n})}):(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,t.jsx)(l.Z,{color:w?"rgba(0, 0, 0, 0.25)":a,children:n})})},ei=[{title:"Tanggal",dataIndex:"d_opr",key:"d_opr"},...B.map((e,a)=>({title:e.n_indicator,dataIndex:["indicator",a,"i_value"],key:"i_value_".concat(e.c_indicator,"_").concat(a),render:(n,r)=>{let o=b()().format("YYYY-MM-DD"),l=b()(r.d_opr).format("YYYY-MM-DD");return w&&4!==r.i_status_active?(0,t.jsx)(i.Z.Item,{name:[r.d_opr,a,"i_value"],style:{margin:0},initialValue:null!==n?n:"",children:(0,t.jsx)(c.default,{name:e.c_indicator,onChange:e=>er(e,r,a),type:"number",disabled:l>o})}):(0,t.jsxs)(t.Fragment,{children:[""==r.indicator[a].i_id?"-":n,"-"!==n&&"PERSEN"===e.n_unit?"%":null]})}})),{title:"Penyebab",children:[{title:"Pemeriksaan yang tidak sesuai Standar Teknis dan SOP",dataIndex:["reason",0,"n_reason_1"],key:"n_reason_1",render:(e,a)=>{let n=b()().format("YYYY-MM-DD"),r=b()(a.d_opr).format("YYYY-MM-DD");return w&&4!==a.i_status_active?(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,t.jsx)(i.Z.Item,{name:[a.d_opr,"n_reason_1"],style:{margin:0},children:(0,t.jsx)(s.Z,{name:"n_reason_1",defaultChecked:e,disabled:r>n,onChange:e=>et(e,a)})})}):e?(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:"✓"}):(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:"-"})}},{title:"Pemeriksaan yang terlambat dilakukan",dataIndex:["reason",0,"n_reason_2"],key:"n_reason_2",render:(e,a)=>{let n=b()().format("YYYY-MM-DD"),r=b()(a.d_opr).format("YYYY-MM-DD");return w&&4!==a.i_status_active?(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,t.jsx)(i.Z.Item,{name:[a.d_opr,"n_reason_2"],style:{margin:0},children:(0,t.jsx)(s.Z,{name:"n_reason_2",defaultChecked:e,disabled:r>n,onChange:e=>et(e,a)})})}):e?(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:"✓"}):(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:"-"})}},{title:"Pengoperasian yang tidak sesuai dengan ketentuan",dataIndex:["reason",0,"n_reason_3"],key:"n_reason_3",render:(e,a)=>{let n=b()().format("YYYY-MM-DD"),r=b()(a.d_opr).format("YYYY-MM-DD");return w&&4!==a.i_status_active?(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,t.jsx)(i.Z.Item,{name:[a.d_opr,"n_reason_3"],style:{margin:0},children:(0,t.jsx)(s.Z,{name:"n_reason_3",defaultChecked:e,disabled:r>n,onChange:e=>et(e,a)})})}):e?(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:"✓"}):(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:"-"})}}]},{title:"Status",dataIndex:"i_status_active",key:"i_status_active",render:e=>eo(e)},{title:"Action",dataIndex:"Action",key:"Action",render:(e,n)=>4===n.i_status_active?(0,t.jsx)(t.Fragment,{children:a.permission.includes("unapprove")&&(0,t.jsx)(d.Z,{className:"pl-2",title:"Sure to unaprove?",onConfirm:ea,disabled:w,children:(0,t.jsx)("a",{onClick:()=>W([n]),style:{color:"red"},children:(0,t.jsx)(u.Z,{placement:"rightTop",title:"Unapprove",arrow:!0,children:(0,t.jsx)("i",{style:{color:w?"rgba(0, 0, 0, 0.25)":"red"},className:"fa-solid fa-circle-xmark fa-2x text-[#FE4545]"})})})})}):1===n.i_status_active?(0,t.jsx)(t.Fragment,{children:a.permission.includes("approve")&&(0,t.jsx)(d.Z,{className:"pl-2",title:"Sure to aprove?",onConfirm:en,disabled:w,children:(0,t.jsxs)("a",{onClick:()=>U([n]),children:[" ",(0,t.jsx)(u.Z,{placement:"rightTop",title:"Approve",arrow:!0,children:(0,t.jsx)(p.ZP,{size:"small",type:"link",shape:"circle",icon:(0,t.jsx)("i",{style:{color:w?"rgba(0, 0, 0, 0.25)":"#1677ff"},className:"fa-solid fa-circle-check fa-2x"})})})]})})}):null}],el=async()=>{let e,a;L(!0);let n=null==Y?void 0:Y.split("-"),t=0,r=0;n&&2===n.length&&(t=parseInt(n[0]),r=parseInt(n[1]),e="".concat(t,"_").concat(t),a="".concat(r,"_").concat(r));let o=await (0,C.Z)().get("/prasarana/indicator?period_year=".concat(e,"&period_month=").concat(a,"&c_dashboard_type=PENGOPERASIAN&c_param=KESELAMATAN"),!0),i=await (0,C.Z)().get("/prasarana/operation/safety?period_year=".concat(e,"&period_month=").concat(a),!0);if((0,x.Z)({res:i.data,app:v})&&(0,x.Z)({res:o.data,app:v})){var l,c;let e=(null==i?void 0:null===(l=i.data)||void 0===l?void 0:l.data)||[],a=(null==o?void 0:null===(c=o.data)||void 0===c?void 0:c.data)||[],n=e.map(e=>{let n=a.map(a=>{let n=e.indicator.find(e=>e.c_indicator===a.c_indicator);return n?{...n}:{n_indicator:a.n_indicator,n_unit:a.n_unit,c_indicator:a.c_indicator,i_id:"",i_value:0}}).filter(Boolean),t=n.length>0,r=e.reason.length>0&&(void 0!==e.reason[0].n_reason_1||void 0!==e.reason[0].n_reason_2);return t&&r?{...e,indicator:n}:null}).filter(Boolean);A(n.filter(e=>1===e.i_status_active).map(e=>({...e,indicator:e.indicator.filter(e=>""!==e.i_id)}))),M(n),N(n),F(a),L(!1)}else A([]),M([]),N([]),F([]),L(!1);L(!1)};return(0,r.useEffect)(()=>{null!==Y&&el()},[Y]),(0,t.jsx)(j.Z,{pathname:n,globalState:a,children:(0,t.jsxs)(_.Z,{children:[(0,t.jsxs)(m.Z,{justify:"space-between",className:"pb-5",children:[(0,t.jsx)(f.Z,{span:12,children:(0,t.jsx)(g.default,{className:"w-full",onChange:e=>{null!==e?I(b()(e).format("YYYY-MM")):I(null)},picker:"month"})}),(0,t.jsxs)(f.Z,{children:[0!==X.length&&(0,t.jsxs)(t.Fragment,{children:[a.permission.includes("create")&&(0,t.jsx)(p.ZP,{disabled:null===Y,type:"primary",loading:z,onClick:w?$:()=>{D(!0)},children:w?"Save":z?"Menyimpan":"Edit"}),w||0==P.length?null:a.permission.includes("approve")&&(0,t.jsx)(p.ZP,{disabled:null==Y,onClick:ee,type:"primary",className:"ml-2",loading:z,children:z?"Menyimpan":"Approval"})]}),w&&(0,t.jsx)(p.ZP,{disabled:null==Y,type:"default",onClick:()=>{N(O),D(!1)},className:"ml-2",children:"Cancel"})]})]}),0===X.length?(0,t.jsx)(y.Z,{imageStyle:{height:200}}):(0,t.jsx)(i.Z,{form:T,component:!1,children:(0,t.jsx)(h.Z,{columns:Z.x4.web.headerTable(ei),loading:R,bordered:!0,dataSource:X,scroll:{x:"max-content"},pagination:!1})})]})})}},95381:function(e,a,n){"use strict";var t=n(90265);a.Z=t.Z},77733:function(e,a,n){"use strict";var t=n(43134);a.Z=t.Z},3650:function(e,a,n){"use strict";n.d(a,{Z:function(){return N}});var t=n(2265),r=n(56800),o=n.n(r),i=n(88474),l=n(25629),c=n(63575),s=n(76415),d=n(50511),u=n(38750),p=n(37540),_=n(70142),m=n(98170),f=n(35413),g=n(2330);let y=e=>{let{paddingXXS:a,lineWidth:n,tagPaddingHorizontal:t,componentCls:r,calc:o}=e,i=o(t).sub(n).equal(),l=o(a).sub(n).equal();return{[r]:Object.assign(Object.assign({},(0,m.Wf)(e)),{display:"inline-block",height:"auto",marginInlineEnd:e.marginXS,paddingInline:i,fontSize:e.tagFontSize,lineHeight:e.tagLineHeight,whiteSpace:"nowrap",background:e.defaultBg,border:"".concat((0,p.bf)(e.lineWidth)," ").concat(e.lineType," ").concat(e.colorBorder),borderRadius:e.borderRadiusSM,opacity:1,transition:"all ".concat(e.motionDurationMid),textAlign:"start",position:"relative",["&".concat(r,"-rtl")]:{direction:"rtl"},"&, a, a:hover":{color:e.defaultColor},["".concat(r,"-close-icon")]:{marginInlineStart:l,fontSize:e.tagIconSize,color:e.colorTextDescription,cursor:"pointer",transition:"all ".concat(e.motionDurationMid),"&:hover":{color:e.colorTextHeading}},["&".concat(r,"-has-color")]:{borderColor:"transparent",["&, a, a:hover, ".concat(e.iconCls,"-close, ").concat(e.iconCls,"-close:hover")]:{color:e.colorTextLightSolid}},"&-checkable":{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",["&:not(".concat(r,"-checkable-checked):hover")]:{color:e.colorPrimary,backgroundColor:e.colorFillSecondary},"&:active, &-checked":{color:e.colorTextLightSolid},"&-checked":{backgroundColor:e.colorPrimary,"&:hover":{backgroundColor:e.colorPrimaryHover}},"&:active":{backgroundColor:e.colorPrimaryActive}},"&-hidden":{display:"none"},["> ".concat(e.iconCls," + span, > span + ").concat(e.iconCls)]:{marginInlineStart:i}}),["".concat(r,"-borderless")]:{borderColor:"transparent",background:e.tagBorderlessBg}}},h=e=>{let{lineWidth:a,fontSizeIcon:n,calc:t}=e,r=e.fontSizeSM;return(0,f.IX)(e,{tagFontSize:r,tagLineHeight:(0,p.bf)(t(e.lineHeightSM).mul(r).equal()),tagIconSize:t(n).sub(t(a).mul(2)).equal(),tagPaddingHorizontal:8,tagBorderlessBg:e.defaultBg})},v=e=>({defaultBg:new _.C(e.colorFillQuaternary).onBackground(e.colorBgContainer).toHexString(),defaultColor:e.colorText});var b=(0,g.I$)("Tag",e=>y(h(e)),v),x=function(e,a){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&0>a.indexOf(t)&&(n[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,t=Object.getOwnPropertySymbols(e);r<t.length;r++)0>a.indexOf(t[r])&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(n[t[r]]=e[t[r]]);return n};let C=t.forwardRef((e,a)=>{let{prefixCls:n,style:r,className:i,checked:l,onChange:c,onClick:s}=e,d=x(e,["prefixCls","style","className","checked","onChange","onClick"]),{getPrefixCls:p,tag:_}=t.useContext(u.E_),m=p("tag",n),[f,g,y]=b(m),h=o()(m,"".concat(m,"-checkable"),{["".concat(m,"-checkable-checked")]:l},null==_?void 0:_.className,i,g,y);return f(t.createElement("span",Object.assign({},d,{ref:a,style:Object.assign(Object.assign({},r),null==_?void 0:_.style),className:h,onClick:e=>{null==c||c(!l),null==s||s(e)}})))});var j=n(57758);let k=e=>(0,j.Z)(e,(a,n)=>{let{textColor:t,lightBorderColor:r,lightColor:o,darkColor:i}=n;return{["".concat(e.componentCls).concat(e.componentCls,"-").concat(a)]:{color:t,background:o,borderColor:r,"&-inverse":{color:e.colorTextLightSolid,background:i,borderColor:i},["&".concat(e.componentCls,"-borderless")]:{borderColor:"transparent"}}}});var S=(0,g.bk)(["Tag","preset"],e=>k(h(e)),v);let Z=(e,a,n)=>{let t="string"!=typeof n?n:n.charAt(0).toUpperCase()+n.slice(1);return{["".concat(e.componentCls).concat(e.componentCls,"-").concat(a)]:{color:e["color".concat(n)],background:e["color".concat(t,"Bg")],borderColor:e["color".concat(t,"Border")],["&".concat(e.componentCls,"-borderless")]:{borderColor:"transparent"}}}};var Y=(0,g.bk)(["Tag","status"],e=>{let a=h(e);return[Z(a,"success","Success"),Z(a,"processing","Info"),Z(a,"error","Error"),Z(a,"warning","Warning")]},v),I=function(e,a){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&0>a.indexOf(t)&&(n[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,t=Object.getOwnPropertySymbols(e);r<t.length;r++)0>a.indexOf(t[r])&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(n[t[r]]=e[t[r]]);return n};let E=t.forwardRef((e,a)=>{let{prefixCls:n,className:r,rootClassName:p,style:_,children:m,icon:f,color:g,onClose:y,bordered:h=!0,visible:v}=e,x=I(e,["prefixCls","className","rootClassName","style","children","icon","color","onClose","bordered","visible"]),{getPrefixCls:C,direction:j,tag:k}=t.useContext(u.E_),[Z,E]=t.useState(!0),N=(0,i.Z)(x,["closeIcon","closable"]);t.useEffect(()=>{void 0!==v&&E(v)},[v]);let O=(0,l.o2)(g),M=(0,l.yT)(g),P=O||M,A=Object.assign(Object.assign({backgroundColor:g&&!P?g:void 0},null==k?void 0:k.style),_),w=C("tag",n),[D,T,B]=b(w),F=o()(w,null==k?void 0:k.className,{["".concat(w,"-").concat(g)]:P,["".concat(w,"-has-color")]:g&&!P,["".concat(w,"-hidden")]:!Z,["".concat(w,"-rtl")]:"rtl"===j,["".concat(w,"-borderless")]:!h},r,p,T,B),R=e=>{e.stopPropagation(),null==y||y(e),e.defaultPrevented||E(!1)},[,L]=(0,c.Z)((0,c.w)(e),(0,c.w)(k),{closable:!1,closeIconRender:e=>{let a=t.createElement("span",{className:"".concat(w,"-close-icon"),onClick:R},e);return(0,s.wm)(e,a,e=>({onClick:a=>{var n;null===(n=null==e?void 0:e.onClick)||void 0===n||n.call(e,a),R(a)},className:o()(null==e?void 0:e.className,"".concat(w,"-close-icon"))}))}}),z="function"==typeof x.onClick||m&&"a"===m.type,H=f||null,q=H?t.createElement(t.Fragment,null,H,m&&t.createElement("span",null,m)):m,G=t.createElement("span",Object.assign({},N,{ref:a,className:F,style:A}),q,L,O&&t.createElement(S,{key:"preset",prefixCls:w}),M&&t.createElement(Y,{key:"status",prefixCls:w}));return D(z?t.createElement(d.Z,{component:"Tag"},G):G)});E.CheckableTag=C;var N=E}},function(e){e.O(0,[2505,8173,9141,2470,3919,8348,2100,4309,5053,5458,2034,9155,7824,428,8421,8028,4052,5325,6487,8378,4746,7149,3454,1319,7642,2971,7023,1744],function(){return e(e.s=50678)}),_N_E=e.O()}]);