(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5221],{29159:function(e,t,a){Promise.resolve().then(a.bind(a,6295))},6295:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return L}});var n=a(57437),l=a(2265),s=a(72100),r=a(29108),i=a(25325),d=a(73454),c=a(68348),o=a(30252),p=a(88625),u=a(62476),m=a(18357),x=a(77733),h=a(95381),g=a(95053),y=a(46682),j=a(38378),_=a(62737),Z=a.n(_),v=a(9257),b=a(56115),f=a(66456),k=a(38797),I=a(42005),S=a(30939),C=e=>{let{open:t,onCancel:a,getData:r}=e,{message:o}=c.Z.useApp(),p=c.Z.useApp(),[u]=d.Z.useForm(),[m,_]=(0,l.useState)(""),[C,E]=(0,l.useState)(""),[N,P]=(0,l.useState)([]),[A,w]=(0,l.useState)(null),[T,D]=(0,l.useState)(!1),[F,M]=(0,l.useState)([]),L=()=>{let e=((N.length>0?parseInt(N[N.length-1].key,10):0)+1).toString();P([...N,{key:e,description:"",value:0,type:"DECIMAL"}])},R=()=>{let e=((N.length>0?parseInt(N[N.length-2].key,10):0)+1).toString(),t=N.length-1;P([...N.slice(0,t),{key:e,description:"",value:0,type:"DECIMAL"},...N.slice(t)])},Y=(e,t)=>{P(N.map(a=>a.key===e?{...a,description:t}:a))},O=(e,t)=>{P(N.map(a=>a.key===e?{...a,value:t}:a))},q=e=>{P(N.filter(t=>t.key!==e))},K=(e,t)=>{P(N.map(a=>a.key===e?{...a,type:t}:a))},V=async e=>{let t=await (0,I.Z)().get("/prasarana/master/parameter?c_dashboard_type=".concat(e),!0);(0,S.Z)({res:t.data,app:p})?M(t.data.data.map(e=>({value:e.c_param,label:e.n_param}))):M([]),E(e)},z=async()=>{try{await u.validateFields(),D(!0);let e=null==A?void 0:A.split("-"),t=0,n=0;e&&2===e.length&&(t=parseInt(e[0]),n=parseInt(e[1]));let l=N.map((e,t)=>({c_dashboard_type:C,c_param:m,n_indicator:e.description,i_target:e.value,n_unit:e.type,i_order:t+1,b_is_last:!1})),s={period_year:t,period_month:n,data:l},i=await (0,I.Z)().post("/prasarana/master/target",s);console.log("response",i),(0,S.Z)({res:i,app:p})&&(r(),a(),_(""),E(""),u.resetFields(),o.success("Successful Save"),P([])),D(!1)}catch(e){o.error("Form tidak valid, periksa kembali input Anda.")}},{Option:G}=s.default,W=[{title:"Deskripsi",dataIndex:"description",render:(e,t)=>(0,n.jsx)(d.Z.Item,{name:["dataSources",t.key,"description"],rules:[{required:!0,message:"Deskripsi harus diisi!"}],children:(0,n.jsx)(i.default,{disabled:""==m,value:t.description,onChange:e=>Y(t.key,e.target.value)})})},{title:"Target",dataIndex:"target",width:"200px",render:(e,t)=>(0,n.jsx)(d.Z.Item,{name:["dataSources",t.key,"value"],rules:[{required:!0,message:"Target harus diisi!"}],children:(0,n.jsx)(i.default,{disabled:""==m,type:"number",value:t.value,onChange:e=>O(t.key,parseFloat(e.target.value))})})},{title:"Tipe Data",dataIndex:"type",width:"100px",render:(e,t)=>(0,n.jsx)("div",{style:{alignContent:"center",justifyContent:"center",alignItems:"center",display:"flex"},children:(0,n.jsx)(d.Z.Item,{name:["dataSources",t.key,"type"],initialValue:t.type,rules:[{required:!0,message:"Tipe Data harus dipilih!"}],children:(0,n.jsxs)(s.default,{disabled:""==m,value:t.type,placeholder:"DECIMAL",onChange:e=>K(t.key,e),children:[(0,n.jsx)(G,{value:"DECIMAL",children:"DECIMAL"}),(0,n.jsx)(G,{value:"PERSEN",children:"PERSEN"})]})})})},{title:"Action",dataIndex:"action",render:(e,t,a)=>(0,n.jsx)("div",{style:{alignContent:"center",justifyContent:"center",alignItems:"center",display:"flex"},children:"Pengoperasian"!==C&&"Operasional"!==m?a===N.length-1?(0,n.jsx)(y.ZP,{disabled:""==m,type:"primary",shape:"circle",icon:(0,n.jsx)(b.Z,{}),onClick:L}):(0,n.jsx)(y.ZP,{disabled:""==m,danger:!0,shape:"circle",icon:(0,n.jsx)(f.Z,{}),onClick:()=>q(t.key)}):a===N.length-2?(0,n.jsx)(y.ZP,{disabled:""==m,type:"primary",shape:"circle",icon:(0,n.jsx)(b.Z,{}),onClick:R}):a<N.length-2&&(0,n.jsx)(y.ZP,{disabled:""==m,danger:!0,shape:"circle",icon:(0,n.jsx)(f.Z,{}),onClick:()=>q(t.key)})})}];return(0,l.useEffect)(()=>{P([{key:"1",description:"",value:0,type:"DECIMAL"}])},[C,m]),(0,n.jsx)(d.Z,{form:u,layout:"vertical",children:(0,n.jsxs)(v.Z,{title:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("span",{children:"Tambah Indikator"}),(0,n.jsx)(y.ZP,{disabled:null==A||""==C||""==m,loading:T,type:"primary",onClick:z,className:"mr-8",children:T?"Saving":"Save"})]}),centered:!0,open:t,onCancel:()=>{a(),_(""),E("")},footer:null,width:"60vw",children:[(0,n.jsx)("div",{className:"pr-5 text-[14px] font-semibold",children:"Periode :"}),(0,n.jsx)(x.Z,{justify:"space-between",className:"pb-2",children:(0,n.jsx)(h.Z,{span:12,children:(0,n.jsx)(g.default,{className:"w-full",onChange:e=>{null!==e?w(Z()(e).format("YYYY-MM")):w(null)},picker:"month"})})}),(0,n.jsxs)(x.Z,{gutter:[16,16],children:[(0,n.jsx)(h.Z,{className:"pr-5 text-[14px] font-semibold",span:12,children:"Tipe Kinerja"}),(0,n.jsx)(h.Z,{className:"pr-5 text-[14px] font-semibold",span:12,children:"Parameter"})]}),(0,n.jsxs)(x.Z,{gutter:[16,16],className:"pb-5",children:[(0,n.jsx)(h.Z,{span:12,children:(0,n.jsx)(s.default,{disabled:null==A,placeholder:"Select Type",onChange:V,value:""==C?"Select Type":C,className:"w-full",options:[{value:"PERAWATAN",label:"PERAWATAN"},{value:"PENGOPERASIAN",label:"PENGOPERASIAN"}]})}),(0,n.jsx)(h.Z,{span:12,children:(0,n.jsx)(s.default,{disabled:""==C,placeholder:"Select Parameter",onChange:e=>{_(e)},value:""==m?"Select Parameter":m,className:"w-full",options:F})})]}),(0,n.jsx)(j.Z,{dataSource:N,pagination:!1,size:"small",columns:k.x4.web.headerTable(W)})]})})},E=a(65188),N=a(71275),P=a(16463),A=a(96217),w=a(97156),T=a(71480),D=a(9707);let{Option:F}=s.default,M=e=>{let t,{editing:a,dataIndex:l,title:c,inputType:o,record:p,index:u,children:m,...x}=e;return t="number"==o?(0,n.jsx)(r.Z,{}):"select"===o?(0,n.jsxs)(s.default,{children:[(0,n.jsx)(F,{value:"DECIMAL",children:"DECIMAL"}),(0,n.jsx)(F,{value:"PERSEN",children:"PERSEN"})]}):(0,n.jsx)(i.default,{}),(0,n.jsx)("td",{...x,children:a?(0,n.jsx)(d.Z.Item,{name:l,style:{margin:0},rules:[{required:!0,message:"Please Input ".concat(c,"!")}],children:t}):m})};var L=()=>{let{message:e}=c.Z.useApp(),t=(0,l.useContext)(N.Z),a=(0,P.usePathname)(),s=c.Z.useApp(),[r]=d.Z.useForm(),[i]=d.Z.useForm(),[_,v]=(0,l.useState)([]),[b,f]=(0,l.useState)([]),[F,L]=(0,l.useState)(""),[R,Y]=(0,l.useState)(""),[O,q]=(0,l.useState)(null),[K,V]=(0,l.useState)(!1),[z,G]=(0,l.useState)(!1),[W,B]=(0,l.useState)(!1),[H,J]=(0,l.useState)(""),[Q,U]=(0,l.useState)(""),X=e=>e.key===F,$=e=>{r.setFieldsValue({n_indicator:"",i_target:"",n_unit:"",...e}),L(e.key)},ee=e=>e.key===R,et=e=>{i.setFieldsValue({n_indicator:"",i_target:"",n_unit:"",...e}),Y(e.key)},ea=()=>{L("")},en=()=>{Y("")},el=async t=>{try{let a=await r.validateFields(),n=[..._],l=n.findIndex(e=>t===e.key);if(l>-1){let t=n[l];n.splice(l,1,{...t,...a});let r=n[l],i=await (0,I.Z)().put("/prasarana/master/target",r);(0,S.Z)({res:i,app:s}),(0,S.Z)({res:i,app:s})?(V(!1),e.success("Successful Save"),eo()):V(!1),L("")}else n.push(a),v(n),L("")}catch(e){console.log("Validate Failed:",e)}},es=async t=>{try{let a=await i.validateFields(),n=[...b],l=n.findIndex(e=>t===e.key);if(l>-1){let t=n[l];n.splice(l,1,{...t,...a});let r=n[l],i=await (0,I.Z)().put("/prasarana/master/target",r);(0,S.Z)({res:i,app:s}),(0,S.Z)({res:i,app:s})?(e.success("Successful Save"),V(!1),eo()):V(!1),Y("")}}catch(e){console.log("Validate Failed:",e)}},er=async()=>{let t=await (0,I.Z)().post("/prasarana/master/target/delete",{i_id:H});(0,S.Z)({res:t,app:s}),(0,S.Z)({res:t,app:s})?(e.success("Successful delete"),V(!1),eo()):V(!1)},ei=async()=>{let t=await (0,I.Z)().post("/prasarana/master/target/delete",{i_id:Q});(0,S.Z)({res:t,app:s}),(0,S.Z)({res:t,app:s})?(V(!1),e.success("Successful delete"),eo()):V(!1)},ed=[{title:"Parameter Kinerja Perawatan",dataIndex:"n_param",key:"n_param"},{title:"Indikator Kinerja",dataIndex:"n_indicator",key:"n_indicator",editable:!0},{title:"Target",dataIndex:"i_target",key:"i_target",align:"center",editable:!0,render:(e,t)=>{console.log("record",t);let a="PERSEN"===t.n_unit?"%":"";return(0,n.jsx)(n.Fragment,{children:"".concat(e).concat(a)})}},{title:"Tipe Data",dataIndex:"n_unit",key:"n_unit",align:"center",editable:!0},{title:"Action",dataIndex:"action",key:"action",align:"center",render:(e,a)=>X(a)?(0,n.jsxs)("span",{children:[(0,n.jsx)(o.default.Link,{onClick:()=>el(a.key),style:{marginRight:8},disabled:K,children:(0,n.jsx)(p.Z,{placement:"top",className:" mt-1 ",title:"Save",children:(0,n.jsx)(A.Z,{})})}),(0,n.jsx)(u.Z,{title:"Sure to cancel?",onConfirm:ea,children:(0,n.jsx)(p.Z,{placement:"top",className:" mt-1 ",title:"Cancel",children:(0,n.jsx)(w.Z,{style:{color:"red",transition:"color 0.3s ease"},onMouseEnter:e=>e.currentTarget.style.color="#F47575",onMouseLeave:e=>e.currentTarget.style.color="red"})})})]}):(0,n.jsxs)(n.Fragment,{children:[t.permission.includes("update")&&1===a.i_status_active&&(0,n.jsx)(o.default.Link,{disabled:""!==F,onClick:()=>$(a),children:(0,n.jsx)(p.Z,{placement:"top",className:" mt-1 ",title:"Edit",children:(0,n.jsx)(T.Z,{})})}),t.permission.includes("delete")&&1===a.i_status_active&&(0,n.jsx)(u.Z,{disabled:""!==F,className:"pl-2",title:"Sure to Delete?",onConfirm:er,children:(0,n.jsx)("a",{onClick:()=>J(a.i_id),style:{color:""===F?"red":"rgba(0, 0, 0, 0.25)"},children:(0,n.jsx)(p.Z,{placement:"top",className:" mt-1 ",title:"Delete",children:(0,n.jsx)(D.Z,{style:{color:""===F?"red":"rgba(0, 0, 0, 0.25)",transition:"color 0.3s ease"},onMouseEnter:e=>e.currentTarget.style.color="#F47575",onMouseLeave:e=>e.currentTarget.style.color=""===F?"red":"rgba(0, 0, 0, 0.25)"})})})})]})}].map(e=>e.editable?{...e,onCell:t=>({record:t,inputType:"i_target"===e.dataIndex?"number":"n_unit"===e.dataIndex?"select":"n_indicator"===e.dataIndex?"text":null,dataIndex:e.dataIndex,title:e.title,editing:X(t)})}:e),ec=[{title:"Parameter Kinerja Pengoperasian",dataIndex:"n_param",key:"n_param"},{title:"Indikator Kinerja",dataIndex:"n_indicator",key:"n_indicator",editable:!0},{title:"Target",dataIndex:"i_target",key:"i_target",align:"center",editable:!0,render:(e,t)=>{let a="PERSEN"===t.n_unit?"%":"";return(0,n.jsx)(n.Fragment,{children:"".concat(e).concat(a)})}},{title:"Tipe Data",dataIndex:"n_unit",key:"n_unit",align:"center",editable:!0},{title:"Action",dataIndex:"action",key:"action",align:"center",render:(e,a)=>ee(a)?(0,n.jsxs)("span",{children:[(0,n.jsx)(o.default.Link,{onClick:()=>es(a.key),style:{marginRight:8},children:(0,n.jsxs)(p.Z,{placement:"top",className:" mt-1 ",title:"Save",children:[(0,n.jsx)(A.Z,{})," "]})}),(0,n.jsx)(u.Z,{title:"Sure to cancel?",onConfirm:en,children:(0,n.jsx)(p.Z,{placement:"top",className:" mt-1 ",title:"Cancel",children:(0,n.jsx)(w.Z,{style:{color:"red",transition:"color 0.3s ease"},onMouseEnter:e=>e.currentTarget.style.color="#F47575",onMouseLeave:e=>e.currentTarget.style.color="red"})})})]}):(0,n.jsxs)(n.Fragment,{children:[t.permission.includes("update")&&1===a.i_status_active&&(0,n.jsx)(o.default.Link,{disabled:""!==R,onClick:()=>et(a),children:(0,n.jsx)(p.Z,{placement:"top",className:" mt-1 ",title:"Edit",children:(0,n.jsx)(T.Z,{})})}),t.permission.includes("delete")&&1===a.i_status_active&&(0,n.jsx)(u.Z,{className:"pl-2",title:"Sure to Delete?",onConfirm:ei,disabled:""!==R,children:(0,n.jsx)("a",{onClick:()=>U(a.i_id),style:{color:""===R?"red":"rgba(0, 0, 0, 0.25)"},children:(0,n.jsx)(p.Z,{placement:"top",className:" mt-1 ",title:"Delete",children:(0,n.jsx)(D.Z,{style:{color:""===R?"red":"rgba(0, 0, 0, 0.25)",transition:"color 0.3s ease"},onMouseEnter:e=>e.currentTarget.style.color="#F47575",onMouseLeave:e=>e.currentTarget.style.color=""===R?"red":"rgba(0, 0, 0, 0.25)"})})})})]})}].map(e=>e.editable?{...e,onCell:t=>({record:t,inputType:"i_target"===e.dataIndex?"number":"n_unit"===e.dataIndex?"select":"n_indicator"===e.dataIndex?"text":null,dataIndex:e.dataIndex,title:e.title,editing:ee(t)})}:e),eo=async()=>{let e,t;G(!0);let a=null==O?void 0:O.split("-"),n=0,l=0;if(a&&2===a.length){n=parseInt(a[0]),l=parseInt(a[1]),e="".concat(n,"_").concat(n),t="".concat(l,"_").concat(l);let o=await (0,I.Z)().get("/prasarana/master/target?period_year=".concat(e,"&period_month=").concat(t,"&c_dashboard_type=PERAWATAN"),!0),p=await (0,I.Z)().get("/prasarana/master/target?period_year=".concat(e,"&period_month=").concat(t,"&c_dashboard_type=PENGOPERASIAN"),!0);if((0,S.Z)({res:p.data,app:s})&&(0,S.Z)({res:o.data,app:s})){var r,i,d,c;Y(""),L("");let e=null==p?void 0:null===(i=p.data)||void 0===i?void 0:null===(r=i.data[0])||void 0===r?void 0:r.data,t=null==o?void 0:null===(c=o.data)||void 0===c?void 0:null===(d=c.data[0])||void 0===d?void 0:d.data;void 0!==e?f(ep(e)):f(ep([])),G(!1),void 0!==t?v(ep(t)):v([]),G(!1)}else v([]),f([]),G(!1)}else v([]),f([]),G(!1)},ep=e=>{let t="abcdefghijklmnopqrstuvwxyz",a=[];return e.forEach(e=>{let n=e.record.sort((e,t)=>e.i_order-t.i_order),l=0;n.forEach((s,r)=>{n.filter(e=>e.i_order).length>1&&t[l%t.length],s.i_order,a.push({i_id:s.c_indicator,n_indicator:"".concat(s.n_indicator),i_target:s.i_target,n_unit:s.n_unit,i_order:s.i_order,n_param2:e.n_param,i_status_active:s.i_status_active,n_param:0===r?e.n_param:"",key:s.c_indicator}),s.i_order,s.i_order,l++})}),a};return(0,l.useEffect)(()=>{null!==O&&eo()},[O]),(0,n.jsx)(E.Z,{pathname:a,globalState:t,children:(0,n.jsxs)("div",{children:[(0,n.jsxs)(m.Z,{children:[(0,n.jsxs)(x.Z,{justify:"space-between",className:"pb-5",children:[(0,n.jsx)(h.Z,{children:(0,n.jsx)(g.default,{className:"lg:mr-3 sm:w-[500px] w-96",onChange:e=>{null!==e?q(Z()(e).format("YYYY-MM")):q(null)},picker:"month"})}),(0,n.jsx)(h.Z,{children:t.permission.includes("create")&&(0,n.jsx)(y.ZP,{type:"primary",onClick:()=>B(!0),children:"ADD"})})]}),(0,n.jsx)(d.Z,{form:r,component:!1,children:(0,n.jsx)(j.Z,{loading:z,components:{body:{cell:M}},dataSource:_,columns:k.x4.web.headerTable(ed),size:"small",scroll:{x:"max-content"},bordered:!0,pagination:!1})}),(0,n.jsx)(d.Z,{form:i,component:!1,children:(0,n.jsx)(j.Z,{loading:z,components:{body:{cell:M}},dataSource:b,columns:k.x4.web.headerTable(ec),size:"small",scroll:{x:"max-content"},bordered:!0,pagination:!1,className:"pt-10"})})]}),(0,n.jsx)(C,{open:W,onCancel:()=>B(!1),getData:()=>eo()})]})})}}},function(e){e.O(0,[2505,8173,9141,2470,3919,8348,2100,4309,5053,5458,2034,9155,7824,428,8421,8028,4052,5325,6487,8378,4746,7149,3454,252,6793,7642,2971,7023,1744],function(){return e(e.s=29159)}),_N_E=e.O()}]);